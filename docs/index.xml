<?xml version="1.0" encoding="UTF-8"?>
<rss  xmlns:atom="http://www.w3.org/2005/Atom" 
      xmlns:media="http://search.yahoo.com/mrss/" 
      xmlns:content="http://purl.org/rss/1.0/modules/content/" 
      xmlns:dc="http://purl.org/dc/elements/1.1/" 
      version="2.0">
<channel>
<title>Data Stories</title>
<link>https://graphdr.github.io/data-stories/index.html</link>
<atom:link href="https://graphdr.github.io/data-stories/index.xml" rel="self" type="application/rss+xml"/>
<description>A blog about visual rhetoric, chart design, and R.</description>
<generator>quarto-0.9.426</generator>
<lastBuildDate>Wed, 09 Mar 2022 05:00:00 GMT</lastBuildDate>
<item>
  <title>Facets that are not small multiples</title>
  <link>https://graphdr.github.io/data-stories/posts/2022-02-19-facets-not-small-multiples/index.html</link>
  <description><![CDATA[ 



<blockquote class="blockquote">
<p>Summary. For data structures having two categorical variables and one quantitative variable, this post illustrates how category independence or dependence influences chart design. Graphs with independent categories (multiway data) are easily created in ggplot2 with the <code>facet_wrap()</code> function; data with dependent categories require <code>facet_grid()</code> with its <code>scales</code> and <code>space</code> arguments to treat unequal vertical scales.</p>
</blockquote>
<p><em>Small multiple</em> design is a good design choice for many data structures. To facilitate visual comparisons, every small-multiple frame (variously called panels, facets, or subplots) has identical scales.</p>
<blockquote class="blockquote">
<p>Small multiples resemble the frames of a movie: a series of graphics, showing the same combination of variables, indexed by changes in another variable. <span class="citation" data-cites="Tufte:1983">(Tufte 1983, 170)</span></p>
</blockquote>
<p><em>Multiway data</em>—a data structure comprising two independent categorical variables and one quantitative response variable—is well-matched to small multiple design.</p>
<blockquote class="blockquote">
<p>What distinguishes multiway data is the cross-classification of the categorical variables; there is a value of the response for each combination of levels of the two categorical variables <span class="citation" data-cites="Cleveland:1993">(Cleveland 1993, 303)</span>.</p>
</blockquote>
<p>However, if the categories happen to be <em>dependent</em>, the data are not multiway and the small multiple design fails. Having come across data of this type in a recent article, I thought it would be interesting to illustrate, given one quantitative variable and two categorical variables, how category independence or dependence influences chart design.</p>
<p>I start with a multiway data set and point out that, as a small-multiple design, the panels share common scales. In ggplot2, small multiples are usually created using <code>facet_wrap()</code>.</p>
<p>The second example has data with dependent categories. The panels share a common, horizontal, quantitative scale but have different category scales, yielding facets that are not small multiples. I use <code>facet_grid()</code> with its <code>scales</code> and <code>space</code> arguments to treat the unequal vertical scales.</p>
<p>The R code for the post is listed under the “R code” pointers.</p>
<div class="cell">
<details>
<summary>R code</summary>
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="co" style="color: #5E5E5E;"># packages used </span></span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;">library</span>(<span class="st" style="color: #20794D;">"data.table"</span>)</span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;">library</span>(<span class="st" style="color: #20794D;">"ggplot2"</span>)</span></code></pre></div>
</details>
</div>
<section id="multiway-example" class="level2">
<h2 class="anchored" data-anchor-id="multiway-example">Multiway example</h2>
<p>The literal textbook example of multiway data and chart design is the livestock chart by Cleveland <span class="citation" data-cites="Cleveland:1993">(1993, 303)</span>. The data set contains counts of 5 types of farm animals in 26 countries in 1967. The independent categories are country and animal type; the quantitative variable is the count.</p>
<p>I obtained a reproduction of the data from <span class="citation" data-cites="UCLA:2021">(UCLA 2021)</span> and saved it as a CSV file in the blog data directory.</p>
<div class="cell">
<details>
<summary>R code</summary>
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="co" style="color: #5E5E5E;"># read the livestock data</span></span>
<span id="cb2-2">DT <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">fread</span>(<span class="st" style="color: #20794D;">"livestock-1967.csv"</span>)</span>
<span id="cb2-3"></span>
<span id="cb2-4"><span class="co" style="color: #5E5E5E;"># examine the data</span></span>
<span id="cb2-5">DT[]</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>     livestock_type        country    count
             &lt;char&gt;         &lt;char&gt;    &lt;num&gt;
  1:         Cattle        Albania   478000
  2:         Cattle        Austria  2536000
  3:         Cattle        Belgium  3246000
  4:         Cattle       Bulgaria  1796000
  5:         Cattle Czechoslovakia  5131000
 ---                                       
126:          Sheep    Switzerland   336000
127:          Sheep         Turkey 70093000
128:          Sheep United Kingdom 32888000
129:          Sheep  Russia et al. 21000000
130:          Sheep     Yugoslavia  7384000</code></pre>
</div>
</div>
<p>The countries are assigned to the rows such that the median count by country increases from bottom to top. The livestock are assigned to the panels such that median count by livestock type increases in <em>graphical order:</em> increasing from left to right and from bottom to top. The logarithm of counts is used for the quantitative scale counts vary by more than four powers of 10.</p>
<div class="cell" data-fig.asp="1.2">
<details>
<summary>R code</summary>
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="fu" style="color: #4758AB;">ggplot</span>(<span class="at" style="color: #657422;">data =</span> DT, <span class="at" style="color: #657422;">mapping =</span> <span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x =</span> <span class="fu" style="color: #4758AB;">log10</span>(count), <span class="at" style="color: #657422;">y =</span> <span class="fu" style="color: #4758AB;">reorder</span>(country, count, median))) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb4-2">  <span class="fu" style="color: #4758AB;">geom_point</span>() <span class="sc" style="color: #5E5E5E;">+</span> </span>
<span id="cb4-3">  <span class="fu" style="color: #4758AB;">facet_wrap</span>(<span class="fu" style="color: #4758AB;">vars</span>(<span class="fu" style="color: #4758AB;">reorder</span>(livestock_type, count, median)), <span class="at" style="color: #657422;">as.table =</span> <span class="cn" style="color: #8f5902;">FALSE</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb4-4">  <span class="fu" style="color: #4758AB;">labs</span>(<span class="at" style="color: #657422;">x =</span> <span class="fu" style="color: #4758AB;">expression</span>(<span class="st" style="color: #20794D;">'Log'</span>[<span class="dv" style="color: #AD0000;">10</span>]<span class="sc" style="color: #5E5E5E;">~</span><span class="st" style="color: #20794D;">'number of livestock'</span>), <span class="at" style="color: #657422;">y =</span> <span class="st" style="color: #20794D;">""</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<p><img src="https://graphdr.github.io/data-stories/posts\2022-02-19-facets-not-small-multiples\index_files\figure-html\chart-livestock-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Typical of small multiple charts in general, all five panels have identical horizontal scales (the count) and identical vertical axes (countries). It follows that the size and aspect ratio of each panel are also identical.</p>
</section>
<section id="when-categories-are-dependent" class="level2">
<h2 class="anchored" data-anchor-id="when-categories-are-dependent">When categories are dependent</h2>
<p>The data set that inspired this post is from an article on a creative expression assignment used in a first-year engineering course <span class="citation" data-cites="Chambers+Reid:2021">(Chambers and Reid 2021)</span>. In response to COVID-19, the course had transitioned from a highly interactive, in-person experience to an asynchronous, online model.</p>
<blockquote class="blockquote">
<p>The instructors designed an assignment to encourage students to creatively express how the course interruption and transition online was affecting them. The assignment encouraged complete freedom of expression and choice of media.</p>
</blockquote>
<p>A data table in the article reports how the student work is coded: 28 creative genres (prose, lyrics, music performance, dance, YouTube, etc.) grouped into 6 media categories (writing, performance, video, graphics, etc.). The quantitative variable is the count of encodings by genre.</p>
<p>Some submissions covered multiple media and genres, for example, an original song in a video would be coded as both. Thus the total of the <code>count</code> column (304 encodings) exceeds the number of submissions (N = 265). The <code>percent</code> column is a derived variable that reports the count as a percentage of N. The sum of the <code>percent</code> column is therefore greater than 100%.</p>
<p>The data are available in the blog data directory.</p>
<div class="cell">
<details>
<summary>R code</summary>
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="co" style="color: #5E5E5E;"># import the data</span></span>
<span id="cb5-2">DT <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">fread</span>(<span class="st" style="color: #20794D;">"creative-assignment-2021.csv"</span>)</span>
<span id="cb5-3"></span>
<span id="cb5-4"><span class="co" style="color: #5E5E5E;"># print the data table</span></span>
<span id="cb5-5">DT[]</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>         medium                 genre count percent
         &lt;char&gt;                &lt;char&gt; &lt;int&gt;   &lt;num&gt;
 1:     Writing                 Prose     6     2.3
 2:     Writing                 Essay    32    12.1
 3:     Writing              Word art     6     2.3
 4:     Writing    Poetry (not haiku)    32    12.1
 5:     Writing                 Haiku     4     1.5
 6:       Music                Lyrics     3     1.1
 7:       Music              Playlist     3     1.1
 8: Performance Music from instrument     6     2.3
 9: Performance  Performance of music     6     2.3
10: Performance                 Dance     2     0.8
11: Performance           Spoken word     2     0.8
12:   Sculpture      Arranged objects     6     2.3
13:   Sculpture             Sculpture     2     0.8
14:   Sculpture                  Lego     2     0.8
15:       Video                TikTok     7     2.6
16:       Video               YouTube     4     1.5
17:       Video            Short-form     9     3.4
18:       Video                 Music     3     1.1
19:       Video           Spoken word     5     1.9
20:    Graphics               Collage    13     4.9
21:    Graphics              Painting    18     6.8
22:    Graphics       Drawing by hand    58    21.9
23:    Graphics   Drawing by computer    10     3.8
24:    Graphics           Photography    15     5.7
25:    Graphics               Cartoon    18     6.8
26:    Graphics                 Emoji     6     2.3
27:    Graphics                  Meme    22     8.3
28:    Graphics            Web design     4     1.5
         medium                 genre count percent</code></pre>
</div>
</div>
<p>The graph I have in mind would have media type assigned to rows and media category assigned to panels. Unlike the livestock example, however, the categorical variables in these data are not independent. For example, web design is associated only with graphics, essay is associated only with writing, etc.</p>
<p>In my first attempt, I use <code>facet_wrap()</code> like I did with the livestock data. The visual problem is obvious…every row has a data marker in one panel only. Because the categories are not independent, the small-multiple design fails.</p>
<div class="cell" data-fig.asp="1.6">
<details>
<summary>R code</summary>
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="co" style="color: #5E5E5E;"># create the first chart </span></span>
<span id="cb7-2">p <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="at" style="color: #657422;">data =</span> DT, <span class="at" style="color: #657422;">mapping =</span> <span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x =</span> percent, <span class="at" style="color: #657422;">y =</span> <span class="fu" style="color: #4758AB;">reorder</span>(genre, count))) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb7-3">  <span class="fu" style="color: #4758AB;">geom_point</span>() <span class="sc" style="color: #5E5E5E;">+</span> </span>
<span id="cb7-4">  <span class="fu" style="color: #4758AB;">facet_wrap</span>(<span class="fu" style="color: #4758AB;">vars</span>(<span class="fu" style="color: #4758AB;">reorder</span>(medium, count)) , <span class="at" style="color: #657422;">as.table =</span> <span class="cn" style="color: #8f5902;">FALSE</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb7-5">  <span class="fu" style="color: #4758AB;">labs</span>(<span class="at" style="color: #657422;">y =</span> <span class="st" style="color: #20794D;">""</span>)</span>
<span id="cb7-6"></span>
<span id="cb7-7"><span class="co" style="color: #5E5E5E;"># display the result</span></span>
<span id="cb7-8">p</span></code></pre></div>
</details>
<div class="cell-output-display">
<p><img src="https://graphdr.github.io/data-stories/posts\2022-02-19-facets-not-small-multiples\index_files\figure-html\chart-assignment-1-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The <code>scales = "free_y"</code> argument of <code>facet_wrap()</code> replaces the common y-scale with only those row labels associated with a panel. I also use the <code>ncol</code> argument to stack the panels in one column with all rows labels aligned on the left. This graph has the essential layout I had in mind—a common quantitative scale but different vertical scales, yielding facets that are not small multiples.</p>
<div class="cell" data-fig.asp="1.5">
<details>
<summary>R code</summary>
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><span class="co" style="color: #5E5E5E;"># edit the previous chart </span></span>
<span id="cb8-2">p <span class="ot" style="color: #003B4F;">&lt;-</span> p <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb8-3">   <span class="fu" style="color: #4758AB;">facet_wrap</span>(<span class="fu" style="color: #4758AB;">vars</span>(<span class="fu" style="color: #4758AB;">reorder</span>(medium, count)) , <span class="at" style="color: #657422;">as.table =</span> <span class="cn" style="color: #8f5902;">FALSE</span>, <span class="at" style="color: #657422;">scales =</span> <span class="st" style="color: #20794D;">"free_y"</span>, <span class="at" style="color: #657422;">ncol =</span> <span class="dv" style="color: #AD0000;">1</span>)</span>
<span id="cb8-4"></span>
<span id="cb8-5"><span class="co" style="color: #5E5E5E;"># display the result</span></span>
<span id="cb8-6">p</span></code></pre></div>
</details>
<div class="cell-output-display">
<p><img src="https://graphdr.github.io/data-stories/posts\2022-02-19-facets-not-small-multiples\index_files\figure-html\label-%20chart-assignment-2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Because <code>facet_wrap()</code> creates panels of equal height, the rows in this case are unequally spaced.</p>
<p>I switch to <code>facet_grid()</code> to space the rows equally in panels of unequal height. The <code>space = "free_y"</code> argument is added to make the panel height proportional to the length of the y scale.</p>
<div class="cell" data-fig.asp="1">
<details>
<summary>R code</summary>
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><span class="co" style="color: #5E5E5E;"># edit the previous chart </span></span>
<span id="cb9-2">p <span class="ot" style="color: #003B4F;">&lt;-</span> p  <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb9-3">  <span class="fu" style="color: #4758AB;">facet_grid</span>(<span class="at" style="color: #657422;">rows =</span> <span class="fu" style="color: #4758AB;">vars</span>(<span class="fu" style="color: #4758AB;">reorder</span>(medium, count)), </span>
<span id="cb9-4">             <span class="at" style="color: #657422;">as.table =</span> <span class="cn" style="color: #8f5902;">FALSE</span>, </span>
<span id="cb9-5">             <span class="at" style="color: #657422;">scales =</span> <span class="st" style="color: #20794D;">"free_y"</span>,</span>
<span id="cb9-6">             <span class="at" style="color: #657422;">space =</span> <span class="st" style="color: #20794D;">"free_y"</span>)</span>
<span id="cb9-7"></span>
<span id="cb9-8"><span class="co" style="color: #5E5E5E;"># display the result</span></span>
<span id="cb9-9">p</span></code></pre></div>
</details>
<div class="cell-output-display">
<p><img src="https://graphdr.github.io/data-stories/posts\2022-02-19-facets-not-small-multiples\index_files\figure-html\chart-assignment-3-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="editing-the-chart" class="level2">
<h2 class="anchored" data-anchor-id="editing-the-chart">Editing the chart</h2>
<p>While the overall layout above is what I want, I would prefer to move the panel labels from the right-hand side to the top of each panel. I could not find a way to do that, so I removed the right-hand label and wrote the media label inside the panel. I edited some other aesthetics as well.</p>
<div class="cell" data-fig.asp="1">
<details>
<summary>R code</summary>
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><span class="co" style="color: #5E5E5E;"># create a y-coordinate for a text geom</span></span>
<span id="cb10-2">DT <span class="ot" style="color: #003B4F;">&lt;-</span> DT[, y_coord_media <span class="sc" style="color: #5E5E5E;">:</span><span class="er" style="color: #AD0000;">=</span> .N<span class="sc" style="color: #5E5E5E;">/</span><span class="dv" style="color: #AD0000;">2</span> <span class="sc" style="color: #5E5E5E;">+</span> <span class="fl" style="color: #AD0000;">0.5</span>, by <span class="ot" style="color: #003B4F;">=</span> medium]</span>
<span id="cb10-3"></span>
<span id="cb10-4"><span class="co" style="color: #5E5E5E;"># create secondary axis data, omit some labels to avoid overprinting</span></span>
<span id="cb10-5">count_scale <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">sort</span>(<span class="fu" style="color: #4758AB;">unique</span>(DT<span class="sc" style="color: #5E5E5E;">$</span>count))</span>
<span id="cb10-6">top_axis <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">data.table</span>(count_scale)</span>
<span id="cb10-7">top_axis[, count_label <span class="sc" style="color: #5E5E5E;">:</span><span class="er" style="color: #AD0000;">=</span> <span class="fu" style="color: #4758AB;">as.character</span>(count_scale)]</span>
<span id="cb10-8">omit_labels <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"3"</span>, <span class="st" style="color: #20794D;">"5"</span>, <span class="st" style="color: #20794D;">"7"</span>, <span class="st" style="color: #20794D;">"9"</span>, <span class="st" style="color: #20794D;">"15"</span>)</span>
<span id="cb10-9">top_axis[count_label <span class="sc" style="color: #5E5E5E;">%chin%</span> omit_labels, count_label <span class="sc" style="color: #5E5E5E;">:</span><span class="er" style="color: #AD0000;">=</span> <span class="st" style="color: #20794D;">""</span>]</span>
<span id="cb10-10"></span>
<span id="cb10-11"><span class="co" style="color: #5E5E5E;"># ratio for secondary axis transformation</span></span>
<span id="cb10-12">scale_trans <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">sum</span>(DT<span class="sc" style="color: #5E5E5E;">$</span>count) <span class="sc" style="color: #5E5E5E;">/</span> <span class="fu" style="color: #4758AB;">sum</span>(DT<span class="sc" style="color: #5E5E5E;">$</span>percent)</span>
<span id="cb10-13"></span>
<span id="cb10-14"><span class="co" style="color: #5E5E5E;"># graph</span></span>
<span id="cb10-15"><span class="fu" style="color: #4758AB;">ggplot</span>(<span class="at" style="color: #657422;">data =</span> DT, <span class="at" style="color: #657422;">mapping =</span> <span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x =</span> percent, <span class="at" style="color: #657422;">y =</span> <span class="fu" style="color: #4758AB;">reorder</span>(genre, count))) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb10-16">  <span class="fu" style="color: #4758AB;">geom_point</span>(<span class="at" style="color: #657422;">size =</span> <span class="dv" style="color: #AD0000;">2</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb10-17">  <span class="fu" style="color: #4758AB;">facet_grid</span>(<span class="at" style="color: #657422;">rows =</span> <span class="fu" style="color: #4758AB;">vars</span>(<span class="fu" style="color: #4758AB;">reorder</span>(medium, count)), </span>
<span id="cb10-18">             <span class="at" style="color: #657422;">as.table =</span> <span class="cn" style="color: #8f5902;">FALSE</span>, </span>
<span id="cb10-19">             <span class="at" style="color: #657422;">scales =</span> <span class="st" style="color: #20794D;">"free_y"</span>,</span>
<span id="cb10-20">             <span class="at" style="color: #657422;">space =</span> <span class="st" style="color: #20794D;">"free_y"</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb10-21">  <span class="fu" style="color: #4758AB;">labs</span>(<span class="at" style="color: #657422;">x =</span> <span class="st" style="color: #20794D;">"Genre encodings (%)"</span>, <span class="at" style="color: #657422;">y =</span> <span class="st" style="color: #20794D;">"Genre"</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb10-22">  <span class="fu" style="color: #4758AB;">theme_light</span>() <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb10-23">  <span class="fu" style="color: #4758AB;">theme</span>(<span class="at" style="color: #657422;">strip.text.y =</span> <span class="fu" style="color: #4758AB;">element_blank</span>(), </span>
<span id="cb10-24">        <span class="at" style="color: #657422;">panel.grid.minor =</span> <span class="fu" style="color: #4758AB;">element_blank</span>(),</span>
<span id="cb10-25">        <span class="at" style="color: #657422;">axis.title.y =</span> <span class="fu" style="color: #4758AB;">element_text</span>(<span class="at" style="color: #657422;">angle =</span> <span class="dv" style="color: #AD0000;">0</span>, <span class="at" style="color: #657422;">hjust =</span> <span class="dv" style="color: #AD0000;">1</span>, <span class="at" style="color: #657422;">vjust =</span> <span class="fl" style="color: #AD0000;">0.5</span>)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb10-26">  <span class="fu" style="color: #4758AB;">geom_text</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x =</span> <span class="dv" style="color: #AD0000;">24</span>, <span class="at" style="color: #657422;">y =</span> y_coord_media, <span class="at" style="color: #657422;">label =</span> medium, <span class="at" style="color: #657422;">hjust =</span> <span class="dv" style="color: #AD0000;">1</span>), <span class="at" style="color: #657422;">color =</span> <span class="st" style="color: #20794D;">"gray50"</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb10-27">  <span class="fu" style="color: #4758AB;">scale_x_continuous</span>(<span class="at" style="color: #657422;">sec.axis =</span> <span class="fu" style="color: #4758AB;">sec_axis</span>(<span class="at" style="color: #657422;">trans =</span> <span class="cf" style="color: #003B4F;">function</span>(z) (z <span class="sc" style="color: #5E5E5E;">*</span> scale_trans), </span>
<span id="cb10-28">                                         <span class="at" style="color: #657422;">name =</span> <span class="st" style="color: #20794D;">"Count of genre encodings"</span>, </span>
<span id="cb10-29">                                         <span class="at" style="color: #657422;">breaks =</span> top_axis<span class="sc" style="color: #5E5E5E;">$</span>count_scale, </span>
<span id="cb10-30">                                         <span class="at" style="color: #657422;">labels =</span> top_axis<span class="sc" style="color: #5E5E5E;">$</span>count_label))</span></code></pre></div>
</details>
<div class="cell-output-display">
<p><img src="https://graphdr.github.io/data-stories/posts\2022-02-19-facets-not-small-multiples\index_files\figure-html\label-%20chart-assignment-4-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Features of the graph</p>
<ul>
<li><code>facet_grid()</code> as shown earlier for panels of unequal height with rows equally spaced.</li>
<li><code>geom_text()</code> for panel labels, vertically centered.</li>
<li><code>sec_axis()</code> for a secondary scale along the top of the chart showing counts of genre encodings from the data table.</li>
<li><code>theme_light()</code> for gray lines on white background to focus attention on the data.</li>
<li>All text is oriented horizontally for ease of reading.</li>
<li>Media are ordered by increasing counts (total count rather than median) from bottom to top.</li>
<li>Within a panel, genres are similarly ordered.</li>
</ul>
</section>
<section id="final-thoughts" class="level2">
<h2 class="anchored" data-anchor-id="final-thoughts">Final thoughts</h2>
<p>Regarding their data table, the authors write,</p>
<blockquote class="blockquote">
<p>… some media were selected by large numbers of students, such as drawings by hand or computer, and writing such as poems and essays.</p>
</blockquote>
<p>The graph supports this assertion but emphasizes visually a couple of other points as well. Drawings by hand, essays, and non-haiku poetry were by far the most popular genres (adding up to nearly 50% of the submission encodings) and graphics was by far the most popular medium (about 60% of the encodings).</p>
<p>Mainly this chart gave me a chance to clarify something that my students would sometimes overlook—that a data structure with two categories and one quantitative variable are multiway data if and only if the categories are independent and a value of the response exists for each combination of levels of the two categories. Otherwise, we cannot expect to use a small-multiple design.</p>



</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Chambers+Reid:2021" class="csl-entry">
Chambers, Benjamin D., and Kenneth J. Reid. 2021. <span>“<span class="nocase">Looking ahead: From driving Cars in the lobby to online: Using open creative expression to understand student emotions about transitioning to remote instruction during the COVID-19 crisis</span>.”</span> <em>Advances in Engineering Education</em> 9 (4). <a href="https://drive.google.com/file/d/1oizZikgEzYKbIlIaBSlaxln5oIpZ4pa3/view">https://drive.google.com/file/d/1oizZikgEzYKbIlIaBSlaxln5oIpZ4pa3/view</a>.
</div>
<div id="ref-Cleveland:1993" class="csl-entry">
Cleveland, William S. 1993. <em><span>Visualizing Data</span></em>. Summit, NJ: <span>Hobart Press</span>.
</div>
<div id="ref-Tufte:1983" class="csl-entry">
Tufte, Edward. 1983. <em><span class="nocase">The Visual Display of Quantitative Information</span></em>. Cheshire, CT: <span>Graphics Press</span>.
</div>
<div id="ref-UCLA:2021" class="csl-entry">
UCLA. 2021. <span>“<span class="nocase">Textbook examples: Visualizing Data by William S. Cleveland</span>.”</span> <span>UCLA Statistical Consulting Group</span>. <a href="https://stats.oarc.ucla.edu/other/examples/vizdata/">https://stats.oarc.ucla.edu/other/examples/vizdata/</a>.
</div>
</div></section></div> ]]></description>
  <category>ggplot2</category>
  <category>R</category>
  <guid>https://graphdr.github.io/data-stories/posts/2022-02-19-facets-not-small-multiples/index.html</guid>
  <pubDate>Wed, 09 Mar 2022 05:00:00 GMT</pubDate>
  <media:content url="https://graphdr.github.io/data-stories//posts/2022-02-19-facets-not-small-multiples/thumbnail.png" medium="image" type="image/png" height="125" width="144"/>
</item>
<item>
  <title>Survey data I/O with likert</title>
  <link>https://graphdr.github.io/data-stories/posts/2022-02-13-survey-data-io/index.html</link>
  <description><![CDATA[ 



<blockquote class="blockquote">
<p>Summary. Given Likert-style survey data in one of three common forms, I shape the data to suit the input requirements of the likert R package and use the output to create 100% stacked-bar charts. In each case, I illustrate two routine revision tasks: editing the question labels on the bars and editing the opinion levels in the legend.</p>
</blockquote>
<p>This post is a tutorial on how to prepare different forms of Likert-style survey data for the R likert package and using its output to create 100% stacked-bar charts. I focus on preparing the data for <code>likert()</code> input and editing its output for the final chart. For exploring the package functionality more fully, I recommend the tutorials by Laura Mudge <span class="citation" data-cites="Mudge:2019">(2019)</span> and Jake Chanenson <span class="citation" data-cites="Chanenson:2021">(2021)</span>.</p>
<p>In a <a href="https://graphdr.github.io/data-stories/posts/2022-02-12-survey-data-chart-designs/">companion post</a> I develop the R script for constructing the 100% stacked-bar chart and discuss the rationale for selecting it as a more effective design for Likert-style survey data.</p>
<p>I use data.table, ggplot2, and likert R packages. An appealing feature of likert is its compatibility with data.table and ggplot2 functionality. Note that to reproduce this work, likert must be at least version 1.3.6 (currently the development version).</p>
<p>The R code for the post is listed under the “R code” pointers.</p>
<div class="cell">
<details>
<summary>R code</summary>
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="co" style="color: #5E5E5E;"># packages</span></span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;">library</span>(<span class="st" style="color: #20794D;">"data.table"</span>)</span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;">library</span>(<span class="st" style="color: #20794D;">"ggplot2"</span>)</span>
<span id="cb1-4"><span class="fu" style="color: #4758AB;">library</span>(<span class="st" style="color: #20794D;">"likert"</span>)</span>
<span id="cb1-5"></span>
<span id="cb1-6"><span class="co" style="color: #5E5E5E;"># function based on likert.plot to construct a 100% stacked bar chart </span></span>
<span id="cb1-7">my_breaks <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">seq</span>(<span class="sc" style="color: #5E5E5E;">-</span><span class="dv" style="color: #AD0000;">100</span>, <span class="dv" style="color: #AD0000;">100</span>, <span class="dv" style="color: #AD0000;">10</span>)</span>
<span id="cb1-8">likert_100_pct_bar <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="cf" style="color: #003B4F;">function</span>(likert_list) {</span>
<span id="cb1-9">  <span class="fu" style="color: #4758AB;">plot</span>(likert_list, </span>
<span id="cb1-10">       <span class="at" style="color: #657422;">plot.percent.neutral =</span> <span class="cn" style="color: #8f5902;">FALSE</span>,</span>
<span id="cb1-11">       <span class="at" style="color: #657422;">plot.percent.high =</span> <span class="cn" style="color: #8f5902;">FALSE</span>,</span>
<span id="cb1-12">       <span class="at" style="color: #657422;">plot.percent.low =</span> <span class="cn" style="color: #8f5902;">FALSE</span>,</span>
<span id="cb1-13">       <span class="at" style="color: #657422;">neutral.color =</span> <span class="st" style="color: #20794D;">"grey90"</span>, </span>
<span id="cb1-14">       <span class="at" style="color: #657422;">include.center =</span> <span class="cn" style="color: #8f5902;">TRUE</span>, </span>
<span id="cb1-15">       <span class="at" style="color: #657422;">centered =</span> <span class="cn" style="color: #8f5902;">FALSE</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb1-16">    <span class="fu" style="color: #4758AB;">geom_hline</span>(<span class="at" style="color: #657422;">yintercept =</span> my_breaks, <span class="at" style="color: #657422;">color =</span> <span class="st" style="color: #20794D;">"white"</span>, <span class="at" style="color: #657422;">size =</span> <span class="fl" style="color: #AD0000;">0.25</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb1-17">    <span class="fu" style="color: #4758AB;">scale_y_continuous</span>(<span class="at" style="color: #657422;">limits =</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="dv" style="color: #AD0000;">0</span>, <span class="dv" style="color: #AD0000;">100</span>), </span>
<span id="cb1-18">                       <span class="at" style="color: #657422;">breaks =</span> my_breaks, </span>
<span id="cb1-19">                       <span class="at" style="color: #657422;">sec.axis =</span> <span class="fu" style="color: #4758AB;">sec_axis</span>( <span class="co" style="color: #5E5E5E;"># second scale</span></span>
<span id="cb1-20">                         <span class="at" style="color: #657422;">trans =</span> <span class="cf" style="color: #003B4F;">function</span>(z) z <span class="sc" style="color: #5E5E5E;">-</span> <span class="dv" style="color: #AD0000;">100</span>, </span>
<span id="cb1-21">                         <span class="at" style="color: #657422;">breaks =</span> my_breaks, </span>
<span id="cb1-22">                         <span class="at" style="color: #657422;">labels =</span> <span class="fu" style="color: #4758AB;">as.character</span>(<span class="fu" style="color: #4758AB;">abs</span>(my_breaks)))) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb1-23">    <span class="fu" style="color: #4758AB;">theme</span>(<span class="at" style="color: #657422;">panel.background =</span> <span class="fu" style="color: #4758AB;">element_blank</span>(),</span>
<span id="cb1-24">          <span class="at" style="color: #657422;">legend.key.size =</span> <span class="fu" style="color: #4758AB;">unit</span>(<span class="dv" style="color: #AD0000;">4</span>, <span class="st" style="color: #20794D;">"mm"</span>),</span>
<span id="cb1-25">          <span class="at" style="color: #657422;">legend.title =</span> <span class="fu" style="color: #4758AB;">element_blank</span>(),</span>
<span id="cb1-26">          <span class="at" style="color: #657422;">axis.ticks =</span> <span class="fu" style="color: #4758AB;">element_blank</span>(), </span>
<span id="cb1-27">          <span class="at" style="color: #657422;">legend.justification =</span> <span class="fl" style="color: #AD0000;">0.5</span>, </span>
<span id="cb1-28">          <span class="at" style="color: #657422;">legend.position =</span> <span class="st" style="color: #20794D;">"top"</span>)</span>
<span id="cb1-29">}</span>
<span id="cb1-30"></span>
<span id="cb1-31"><span class="co" style="color: #5E5E5E;"># labeling vectors</span></span>
<span id="cb1-32">opinion_labels <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"Strongly Disagree"</span>, </span>
<span id="cb1-33">                    <span class="st" style="color: #20794D;">"Disagree"</span>, </span>
<span id="cb1-34">                    <span class="st" style="color: #20794D;">"Neutral"</span>, </span>
<span id="cb1-35">                    <span class="st" style="color: #20794D;">"Agree"</span>, </span>
<span id="cb1-36">                    <span class="st" style="color: #20794D;">"Strongly Agree"</span>)</span>
<span id="cb1-37"></span>
<span id="cb1-38">question_labels <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"Beyond the content"</span>, </span>
<span id="cb1-39">                     <span class="st" style="color: #20794D;">"Analyze errors"</span>, </span>
<span id="cb1-40">                     <span class="st" style="color: #20794D;">"Provide facts"</span>, </span>
<span id="cb1-41">                     <span class="st" style="color: #20794D;">"Develop writing"</span>, </span>
<span id="cb1-42">                     <span class="st" style="color: #20794D;">"Independent learning"</span>)</span>
<span id="cb1-43"></span>
<span id="cb1-44"><span class="co" style="color: #5E5E5E;"># functions for renaming columns</span></span>
<span id="cb1-45">setnames_Item <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="cf" style="color: #003B4F;">function</span>(x) {</span>
<span id="cb1-46">  <span class="fu" style="color: #4758AB;">setnames</span>(x, <span class="at" style="color: #657422;">old =</span> <span class="st" style="color: #20794D;">"q_no"</span>, <span class="at" style="color: #657422;">new =</span> <span class="st" style="color: #20794D;">"Item"</span>, <span class="at" style="color: #657422;">skip_absent =</span> <span class="cn" style="color: #8f5902;">TRUE</span>)</span>
<span id="cb1-47">}</span>
<span id="cb1-48"></span>
<span id="cb1-49">setnames_opinion_labels <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="cf" style="color: #003B4F;">function</span>(x) {</span>
<span id="cb1-50">  <span class="fu" style="color: #4758AB;">setnames</span>(x, </span>
<span id="cb1-51">           <span class="at" style="color: #657422;">old =</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"str_disagree"</span>, </span>
<span id="cb1-52">                   <span class="st" style="color: #20794D;">"disagree"</span>, </span>
<span id="cb1-53">                   <span class="st" style="color: #20794D;">"neutral"</span>, </span>
<span id="cb1-54">                   <span class="st" style="color: #20794D;">"agree"</span>, </span>
<span id="cb1-55">                   <span class="st" style="color: #20794D;">"str_agree"</span>), </span>
<span id="cb1-56">           <span class="at" style="color: #657422;">new =</span> opinion_labels, </span>
<span id="cb1-57">           <span class="at" style="color: #657422;">skip_absent =</span> <span class="cn" style="color: #8f5902;">TRUE</span>)</span>
<span id="cb1-58">}</span></code></pre></div>
</details>
</div>
<section id="data" class="level2">
<h2 class="anchored" data-anchor-id="data">Data</h2>
<p>The practice data in my example are from an engineering education article by Ashanthi Maxworth <span class="citation" data-cites="Maxworth:2021">(2021)</span>, selected because the data are compact and the survey includes a Neutral option. The table from the original article is shown below. There were 31 respondents.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://graphdr.github.io/data-stories/posts\2022-02-13-survey-data-io\survey-data.png" class="img-fluid figure-img"></p>
<p></p><p></p>
</figure>
</div>
<p>Survey data are most likely to be reported in one of three forms: summary percentages (as above), summary counts, or row-records. The <code>likert()</code> function accepts any of these forms as input. The practice data, in all three forms, are available in the <a href="https://github.com/graphdr/data-stories/tree/main/posts/2022-02-13-survey-data-io">blog post directory</a> in CSV files.</p>
<ul>
<li>summary counts: <code>case-study-2021-count.csv</code></li>
<li>summary percentages: <code>case-study-2021-percent.csv</code></li>
<li>row-records: <code>case-study-2021-row-record.csv</code></li>
</ul>
</section>
<section id="summary-counts" class="level2">
<h2 class="anchored" data-anchor-id="summary-counts">Summary counts</h2>
<p>Read the prepared data file in summary count form.</p>
<div class="cell">
<details>
<summary>R code</summary>
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="co" style="color: #5E5E5E;"># read prepared data</span></span>
<span id="cb2-2">dt <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">fread</span>(<span class="st" style="color: #20794D;">"case-study-2021-count.csv"</span>)</span></code></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>R code</summary>
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">knitr<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">kable</span>(dt)</span></code></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<thead>
<tr class="header">
<th style="text-align: left;">q_no</th>
<th style="text-align: right;">str_disagree</th>
<th style="text-align: right;">disagree</th>
<th style="text-align: right;">neutral</th>
<th style="text-align: right;">agree</th>
<th style="text-align: right;">str_agree</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Q1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">9</td>
</tr>
<tr class="even">
<td style="text-align: left;">Q2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">6</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Q3</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">15</td>
</tr>
<tr class="even">
<td style="text-align: left;">Q4</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">7</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Q5</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">12</td>
</tr>
</tbody>
</table>
</div>
</div>
<section id="likert-input" class="level3">
<h3 class="anchored" data-anchor-id="likert-input"><code>likert()</code> input</h3>
<p>I rename the first column <code>Item</code> for consistency with the <code>likert()</code> function.</p>
<div class="cell">
<details>
<summary>R code</summary>
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="co" style="color: #5E5E5E;"># rename first column</span></span>
<span id="cb4-2"><span class="fu" style="color: #4758AB;">setnames_Item</span>(dt)</span>
<span id="cb4-3"></span>
<span id="cb4-4"><span class="co" style="color: #5E5E5E;"># examine the result</span></span>
<span id="cb4-5">dt[]</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>     Item str_disagree disagree neutral agree str_agree
   &lt;char&gt;        &lt;int&gt;    &lt;int&gt;   &lt;int&gt; &lt;int&gt;     &lt;int&gt;
1:     Q1            2        0       8    12         9
2:     Q2            2        2       7    14         6
3:     Q3            1        1       5     9        15
4:     Q4            0        2      10    12         7
5:     Q5            2        0       6    11        12</code></pre>
</div>
</div>
<p>The <code>likert()</code> function accepts input data frames having this structure. The salient characteristics are:</p>
<ul>
<li>one row per question</li>
<li>first column is named <code>Item</code> and contains the question labels</li>
<li>remaining columns are named for the opinion levels in increasing order left to right</li>
<li>column values are the counts of respondents choosing that option</li>
<li>the sum of row counts is the number of respondents answering that question</li>
</ul>
</section>
<section id="likert-output" class="level3">
<h3 class="anchored" data-anchor-id="likert-output"><code>likert()</code> output</h3>
<p>To operate on this data frame, we assign it to the <code>summary</code> argument of the <code>likert()</code> function. The result is a list of various statistics about the Likert-style data. Note that the <code>results</code> output preserves the data.table structure of the input.</p>
<div class="cell">
<details>
<summary>R code</summary>
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="co" style="color: #5E5E5E;"># create the likert list</span></span>
<span id="cb6-2">likert_list <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">likert</span>(<span class="at" style="color: #657422;">summary =</span> dt)</span>
<span id="cb6-3"></span>
<span id="cb6-4"><span class="co" style="color: #5E5E5E;"># examine its structure</span></span>
<span id="cb6-5"><span class="fu" style="color: #4758AB;">str</span>(likert_list)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>List of 5
 $ results :Classes 'data.table' and 'data.frame':  5 obs. of  6 variables:
  ..$ Item        : chr [1:5] "Q1" "Q2" "Q3" "Q4" ...
  ..$ str_disagree: num [1:5] 6.45 6.45 3.23 0 6.45
  ..$ disagree    : num [1:5] 0 6.45 3.23 6.45 0
  ..$ neutral     : num [1:5] 25.8 22.6 16.1 32.3 19.4
  ..$ agree       : num [1:5] 38.7 45.2 29 38.7 35.5
  ..$ str_agree   : num [1:5] 29 19.4 48.4 22.6 38.7
  ..- attr(*, ".internal.selfref")=&lt;externalptr&gt; 
 $ items   : NULL
 $ grouping: NULL
 $ nlevels : num 5
 $ levels  : chr [1:5] "str_disagree" "disagree" "neutral" "agree" ...
 - attr(*, "class")= chr "likert"</code></pre>
</div>
</div>
<p>The components of the list are:</p>
<dl>
<dt><code>results</code></dt>
<dd>
Data frame. Percentage of responses by question, opinion level, and group.
</dd>
<dt><code>items</code></dt>
<dd>
Data frame. Copy of original row-record input (NULL in this example).
</dd>
<dt><code>grouping</code></dt>
<dd>
Copy of original grouping vector that subsets results (NULL in this example).
</dd>
<dt><code>nlevels</code></dt>
<dd>
Integer. Number of opinion levels used in the calculations.
</dd>
<dt><code>levels</code></dt>
<dd>
Character. Ordered vector of opinion level labels.
</dd>
</dl>
<p><br></p>
</section>
<section id="basic-chart" class="level3">
<h3 class="anchored" data-anchor-id="basic-chart">Basic chart</h3>
<p>To use this list to create a chart, we assign it as the first argument of the <code>plot()</code> function.</p>
<div class="cell" data-fig.asp="0.35">
<details>
<summary>R code</summary>
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><span class="co" style="color: #5E5E5E;"># create the basic chart (default digits = 0 throws an error)</span></span>
<span id="cb8-2"><span class="fu" style="color: #4758AB;">plot</span>(likert_list, <span class="at" style="color: #657422;">digits =</span> <span class="dv" style="color: #AD0000;">1</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<p><img src="https://graphdr.github.io/data-stories/posts\2022-02-13-survey-data-io\index_files\figure-html\unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="stacked-bar-chart" class="level3">
<h3 class="anchored" data-anchor-id="stacked-bar-chart">100% stacked bar chart</h3>
<p>The same list can be used to create a 100% stacked-bar chart by assigning it as the first argument of <code>likert_100_pct_bar()</code>—a function (defined at the top of the post) that wraps <code>likert.plot</code> and sets the likert arguments and ggplot2 functions that produce my preferred design.</p>
<div class="cell" data-fig.asp="0.35">
<details>
<summary>R code</summary>
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><span class="co" style="color: #5E5E5E;"># customize the chart</span></span>
<span id="cb9-2"><span class="fu" style="color: #4758AB;">likert_100_pct_bar</span>(likert_list)</span></code></pre></div>
</details>
<div class="cell-output-display">
<p><img src="https://graphdr.github.io/data-stories/posts\2022-02-13-survey-data-io\index_files\figure-html\unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="legend-key" class="level3">
<h3 class="anchored" data-anchor-id="legend-key">Legend key</h3>
<p>The legend key is edited via the column names of <code>likert_list$results</code>. Viewing its column names,</p>
<div class="cell">
<details>
<summary>R code</summary>
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><span class="fu" style="color: #4758AB;">names</span>(likert_list<span class="sc" style="color: #5E5E5E;">$</span>results)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Item"         "str_disagree" "disagree"     "neutral"      "agree"       
[6] "str_agree"   </code></pre>
</div>
</div>
<p>Using a vector of opinion labels defined at the top of the post, I rename the opinion columns of the data frame.</p>
<div class="cell">
<details>
<summary>R code</summary>
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><span class="co" style="color: #5E5E5E;"># recode the opinion options </span></span>
<span id="cb12-2"><span class="fu" style="color: #4758AB;">setnames_opinion_labels</span>(likert_list<span class="sc" style="color: #5E5E5E;">$</span>results)</span>
<span id="cb12-3"></span>
<span id="cb12-4"><span class="co" style="color: #5E5E5E;"># examine the result</span></span>
<span id="cb12-5"><span class="fu" style="color: #4758AB;">str</span>(likert_list)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>List of 5
 $ results :Classes 'data.table' and 'data.frame':  5 obs. of  6 variables:
  ..$ Item             : chr [1:5] "Q1" "Q2" "Q3" "Q4" ...
  ..$ Strongly Disagree: num [1:5] 6.45 6.45 3.23 0 6.45
  ..$ Disagree         : num [1:5] 0 6.45 3.23 6.45 0
  ..$ Neutral          : num [1:5] 25.8 22.6 16.1 32.3 19.4
  ..$ Agree            : num [1:5] 38.7 45.2 29 38.7 35.5
  ..$ Strongly Agree   : num [1:5] 29 19.4 48.4 22.6 38.7
  ..- attr(*, ".internal.selfref")=&lt;externalptr&gt; 
 $ items   : NULL
 $ grouping: NULL
 $ nlevels : num 5
 $ levels  : chr [1:5] "str_disagree" "disagree" "neutral" "agree" ...
 - attr(*, "class")= chr "likert"</code></pre>
</div>
</div>
<p>The change can be seen in the structure above and in the revised figure.</p>
<div class="cell" data-fig.asp="0.35">
<details>
<summary>R code</summary>
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><span class="co" style="color: #5E5E5E;"># create the chart</span></span>
<span id="cb14-2"><span class="fu" style="color: #4758AB;">likert_100_pct_bar</span>(likert_list)</span></code></pre></div>
</details>
<div class="cell-output-display">
<p><img src="https://graphdr.github.io/data-stories/posts\2022-02-13-survey-data-io\index_files\figure-html\unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="question-labels" class="level3">
<h3 class="anchored" data-anchor-id="question-labels">Question labels</h3>
<p>The question labels are edited via the values in the <code>Item</code> column of <code>likert_list$results</code>. Viewing the first column in vector form,</p>
<div class="cell">
<details>
<summary>R code</summary>
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1">likert_list<span class="sc" style="color: #5E5E5E;">$</span>results[[<span class="st" style="color: #20794D;">"Item"</span>]]</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Q1" "Q2" "Q3" "Q4" "Q5"</code></pre>
</div>
</div>
<p>Using a vector of question labels defined at the top of the post, I substitute them for the values in the original <code>Item</code> column.</p>
<div class="cell">
<details>
<summary>R code</summary>
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><span class="co" style="color: #5E5E5E;"># recode the question labels</span></span>
<span id="cb17-2">likert_list<span class="sc" style="color: #5E5E5E;">$</span>results[, Item <span class="sc" style="color: #5E5E5E;">:</span><span class="er" style="color: #AD0000;">=</span> question_labels]</span>
<span id="cb17-3"></span>
<span id="cb17-4"><span class="co" style="color: #5E5E5E;"># examine the result</span></span>
<span id="cb17-5"><span class="fu" style="color: #4758AB;">str</span>(likert_list)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>List of 5
 $ results :Classes 'data.table' and 'data.frame':  5 obs. of  6 variables:
  ..$ Item             : chr [1:5] "Beyond the content" "Analyze errors" "Provide facts" "Develop writing" ...
  ..$ Strongly Disagree: num [1:5] 6.45 6.45 3.23 0 6.45
  ..$ Disagree         : num [1:5] 0 6.45 3.23 6.45 0
  ..$ Neutral          : num [1:5] 25.8 22.6 16.1 32.3 19.4
  ..$ Agree            : num [1:5] 38.7 45.2 29 38.7 35.5
  ..$ Strongly Agree   : num [1:5] 29 19.4 48.4 22.6 38.7
  ..- attr(*, ".internal.selfref")=&lt;externalptr&gt; 
 $ items   : NULL
 $ grouping: NULL
 $ nlevels : num 5
 $ levels  : chr [1:5] "str_disagree" "disagree" "neutral" "agree" ...
 - attr(*, "class")= chr "likert"</code></pre>
</div>
</div>
<p>Again, the change is seen in the structure above and in the revised figure.</p>
<div class="cell" data-fig.asp="0.35">
<details>
<summary>R code</summary>
<div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><span class="co" style="color: #5E5E5E;"># create the chart</span></span>
<span id="cb19-2"><span class="fu" style="color: #4758AB;">likert_100_pct_bar</span>(likert_list)</span></code></pre></div>
</details>
<div class="cell-output-display">
<p><img src="https://graphdr.github.io/data-stories/posts\2022-02-13-survey-data-io\index_files\figure-html\unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>This approach is somewhat ad-hoc, but works as long as you are careful to write the substitutions in the correct order. If I were programming these steps, I would create additional tables (as in a database) and join the substitutions by clearly assigned key variables.</p>
</section>
<section id="or-edit-the-labels-first" class="level3">
<h3 class="anchored" data-anchor-id="or-edit-the-labels-first">Or edit the labels first</h3>
<p>Alternatively one can produce the same result by editing the opinion labels and question labels of the initial data frame before submitting it to <code>likert()</code>. The row and column structure reflects the changes.</p>
<div class="cell">
<details>
<summary>R code</summary>
<div class="sourceCode cell-code" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><span class="co" style="color: #5E5E5E;"># read prepared data</span></span>
<span id="cb20-2">dt <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">fread</span>(<span class="st" style="color: #20794D;">"case-study-2021-count.csv"</span>)</span>
<span id="cb20-3"></span>
<span id="cb20-4"><span class="co" style="color: #5E5E5E;"># rename columns</span></span>
<span id="cb20-5"><span class="fu" style="color: #4758AB;">setnames_Item</span>(dt)</span>
<span id="cb20-6"><span class="fu" style="color: #4758AB;">setnames_opinion_labels</span>(dt)</span>
<span id="cb20-7"></span>
<span id="cb20-8"><span class="co" style="color: #5E5E5E;"># recode the question labels</span></span>
<span id="cb20-9">dt[, Item <span class="sc" style="color: #5E5E5E;">:</span><span class="er" style="color: #AD0000;">=</span> question_labels]</span>
<span id="cb20-10"></span>
<span id="cb20-11"><span class="co" style="color: #5E5E5E;"># examine the result</span></span>
<span id="cb20-12">dt[]</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                   Item Strongly Disagree Disagree Neutral Agree Strongly Agree
                 &lt;char&gt;             &lt;int&gt;    &lt;int&gt;   &lt;int&gt; &lt;int&gt;          &lt;int&gt;
1:   Beyond the content                 2        0       8    12              9
2:       Analyze errors                 2        2       7    14              6
3:        Provide facts                 1        1       5     9             15
4:      Develop writing                 0        2      10    12              7
5: Independent learning                 2        0       6    11             12</code></pre>
</div>
</div>
<p>The likert list that results is nearly identical to the previous version except the <code>levels</code> vector uses the new opinion labels.</p>
<div class="cell" data-fig.asp="0.35">
<details>
<summary>R code</summary>
<div class="sourceCode cell-code" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><span class="co" style="color: #5E5E5E;"># create the likert list</span></span>
<span id="cb22-2">likert_list <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">likert</span>(<span class="at" style="color: #657422;">summary =</span> dt)</span>
<span id="cb22-3"></span>
<span id="cb22-4"><span class="co" style="color: #5E5E5E;"># examine the result</span></span>
<span id="cb22-5"><span class="fu" style="color: #4758AB;">str</span>(likert_list)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>List of 5
 $ results :Classes 'data.table' and 'data.frame':  5 obs. of  6 variables:
  ..$ Item             : chr [1:5] "Beyond the content" "Analyze errors" "Provide facts" "Develop writing" ...
  ..$ Strongly Disagree: num [1:5] 6.45 6.45 3.23 0 6.45
  ..$ Disagree         : num [1:5] 0 6.45 3.23 6.45 0
  ..$ Neutral          : num [1:5] 25.8 22.6 16.1 32.3 19.4
  ..$ Agree            : num [1:5] 38.7 45.2 29 38.7 35.5
  ..$ Strongly Agree   : num [1:5] 29 19.4 48.4 22.6 38.7
  ..- attr(*, ".internal.selfref")=&lt;externalptr&gt; 
 $ items   : NULL
 $ grouping: NULL
 $ nlevels : num 5
 $ levels  : chr [1:5] "Strongly Disagree" "Disagree" "Neutral" "Agree" ...
 - attr(*, "class")= chr "likert"</code></pre>
</div>
<details>
<summary>R code</summary>
<div class="sourceCode cell-code" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><span class="co" style="color: #5E5E5E;"># create the chart</span></span>
<span id="cb24-2"><span class="fu" style="color: #4758AB;">likert_100_pct_bar</span>(likert_list)</span></code></pre></div>
</details>
<div class="cell-output-display">
<p><img src="https://graphdr.github.io/data-stories/posts\2022-02-13-survey-data-io\index_files\figure-html\unnamed-chunk-15-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="summary-percentages" class="level2">
<h2 class="anchored" data-anchor-id="summary-percentages">Summary percentages</h2>
<p>Read the prepared data file in summary percentage form. The percentages are directly from the table in the source article. Like before, I rename the first column <code>Item</code> for consistency with the <code>likert()</code> function.</p>
<div class="cell">
<details>
<summary>R code</summary>
<div class="sourceCode cell-code" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><span class="co" style="color: #5E5E5E;"># read prepared data</span></span>
<span id="cb25-2">dt <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">fread</span>(<span class="st" style="color: #20794D;">"case-study-2021-percent.csv"</span>)</span>
<span id="cb25-3"></span>
<span id="cb25-4"><span class="co" style="color: #5E5E5E;"># rename first column</span></span>
<span id="cb25-5"><span class="fu" style="color: #4758AB;">setnames_Item</span>(dt)</span></code></pre></div>
</details>
</div>
<div class="cell">
<div class="cell-output-display">
<table class="table table-sm table-striped">
<thead>
<tr class="header">
<th style="text-align: left;">Item</th>
<th style="text-align: right;">str_disagree</th>
<th style="text-align: right;">disagree</th>
<th style="text-align: right;">neutral</th>
<th style="text-align: right;">agree</th>
<th style="text-align: right;">str_agree</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Q1</td>
<td style="text-align: right;">6.5</td>
<td style="text-align: right;">0.0</td>
<td style="text-align: right;">25.8</td>
<td style="text-align: right;">38.7</td>
<td style="text-align: right;">29.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">Q2</td>
<td style="text-align: right;">6.5</td>
<td style="text-align: right;">6.5</td>
<td style="text-align: right;">22.6</td>
<td style="text-align: right;">45.2</td>
<td style="text-align: right;">19.4</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Q3</td>
<td style="text-align: right;">3.2</td>
<td style="text-align: right;">3.2</td>
<td style="text-align: right;">16.1</td>
<td style="text-align: right;">29.0</td>
<td style="text-align: right;">48.4</td>
</tr>
<tr class="even">
<td style="text-align: left;">Q4</td>
<td style="text-align: right;">0.0</td>
<td style="text-align: right;">6.5</td>
<td style="text-align: right;">32.3</td>
<td style="text-align: right;">38.7</td>
<td style="text-align: right;">22.6</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Q5</td>
<td style="text-align: right;">6.5</td>
<td style="text-align: right;">0.0</td>
<td style="text-align: right;">19.4</td>
<td style="text-align: right;">35.5</td>
<td style="text-align: right;">38.7</td>
</tr>
</tbody>
</table>
</div>
</div>
<section id="option-1-convert-percentages-to-counts" class="level3">
<h3 class="anchored" data-anchor-id="option-1-convert-percentages-to-counts">Option 1: Convert percentages to counts</h3>
<p>This option is the most direct approach, assuming we know the number of respondents to each question. In this example we do (though this is not always the case). In this case study we have 31 respondents and all respondents replied to all the questions.</p>
<div class="cell">
<details>
<summary>R code</summary>
<div class="sourceCode cell-code" id="cb26" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><span class="co" style="color: #5E5E5E;"># number of respondents in this example</span></span>
<span id="cb26-2">N_respondents <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="dv" style="color: #AD0000;">31</span></span>
<span id="cb26-3"></span>
<span id="cb26-4"><span class="co" style="color: #5E5E5E;"># identify the numeric columns</span></span>
<span id="cb26-5">sel_cols <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">names</span>(dt)[<span class="fu" style="color: #4758AB;">sapply</span>(dt, is.numeric)]</span>
<span id="cb26-6"></span>
<span id="cb26-7"><span class="co" style="color: #5E5E5E;"># convert percentages to integer counts</span></span>
<span id="cb26-8">dt[, <span class="fu" style="color: #4758AB;">c</span>(sel_cols) <span class="sc" style="color: #5E5E5E;">:</span><span class="er" style="color: #AD0000;">=</span> <span class="fu" style="color: #4758AB;">lapply</span>(.SD, <span class="cf" style="color: #003B4F;">function</span>(x) <span class="fu" style="color: #4758AB;">round</span>(N_respondents <span class="sc" style="color: #5E5E5E;">*</span> x<span class="sc" style="color: #5E5E5E;">/</span><span class="dv" style="color: #AD0000;">100</span>, <span class="dv" style="color: #AD0000;">0</span>)), .SDcols <span class="ot" style="color: #003B4F;">=</span> sel_cols]</span></code></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>R code</summary>
<div class="sourceCode cell-code" id="cb27" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1">knitr<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">kable</span>(dt)</span></code></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<thead>
<tr class="header">
<th style="text-align: left;">Item</th>
<th style="text-align: right;">str_disagree</th>
<th style="text-align: right;">disagree</th>
<th style="text-align: right;">neutral</th>
<th style="text-align: right;">agree</th>
<th style="text-align: right;">str_agree</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Q1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">9</td>
</tr>
<tr class="even">
<td style="text-align: left;">Q2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">6</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Q3</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">15</td>
</tr>
<tr class="even">
<td style="text-align: left;">Q4</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">7</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Q5</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">12</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>This data structure is identical to the one we worked with in the previous section, so we know how to work with it.</p>
</section>
<section id="option-2-use-percentages-as-is" class="level3">
<h3 class="anchored" data-anchor-id="option-2-use-percentages-as-is">Option 2: Use percentages as-is</h3>
<p>This option might be necessary if we do not know the number of respondents replying to each question. Start by reading the data file and again rename the first column <code>Item</code> for consistency with the likert() function.</p>
<div class="cell">
<details>
<summary>R code</summary>
<div class="sourceCode cell-code" id="cb28" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><span class="co" style="color: #5E5E5E;"># read prepared data</span></span>
<span id="cb28-2">dt <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">fread</span>(<span class="st" style="color: #20794D;">"case-study-2021-percent.csv"</span>)</span>
<span id="cb28-3"></span>
<span id="cb28-4"><span class="co" style="color: #5E5E5E;"># rename first column</span></span>
<span id="cb28-5"><span class="fu" style="color: #4758AB;">setnames_Item</span>(dt)</span></code></pre></div>
</details>
</div>
<div class="cell">
<div class="cell-output-display">
<table class="table table-sm table-striped">
<thead>
<tr class="header">
<th style="text-align: left;">Item</th>
<th style="text-align: right;">str_disagree</th>
<th style="text-align: right;">disagree</th>
<th style="text-align: right;">neutral</th>
<th style="text-align: right;">agree</th>
<th style="text-align: right;">str_agree</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Q1</td>
<td style="text-align: right;">6.5</td>
<td style="text-align: right;">0.0</td>
<td style="text-align: right;">25.8</td>
<td style="text-align: right;">38.7</td>
<td style="text-align: right;">29.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">Q2</td>
<td style="text-align: right;">6.5</td>
<td style="text-align: right;">6.5</td>
<td style="text-align: right;">22.6</td>
<td style="text-align: right;">45.2</td>
<td style="text-align: right;">19.4</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Q3</td>
<td style="text-align: right;">3.2</td>
<td style="text-align: right;">3.2</td>
<td style="text-align: right;">16.1</td>
<td style="text-align: right;">29.0</td>
<td style="text-align: right;">48.4</td>
</tr>
<tr class="even">
<td style="text-align: left;">Q4</td>
<td style="text-align: right;">0.0</td>
<td style="text-align: right;">6.5</td>
<td style="text-align: right;">32.3</td>
<td style="text-align: right;">38.7</td>
<td style="text-align: right;">22.6</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Q5</td>
<td style="text-align: right;">6.5</td>
<td style="text-align: right;">0.0</td>
<td style="text-align: right;">19.4</td>
<td style="text-align: right;">35.5</td>
<td style="text-align: right;">38.7</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>With one row per question, the row percentages should sum to 100%. They do, but with an error due to rounding in the reported percentages.</p>
<div class="cell">
<details>
<summary>R code</summary>
<div class="sourceCode cell-code" id="cb29" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><span class="co" style="color: #5E5E5E;"># check row totals of numeric columns</span></span>
<span id="cb29-2">sel_cols <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">names</span>(dt)[<span class="fu" style="color: #4758AB;">sapply</span>(dt, is.numeric)]</span>
<span id="cb29-3">row_sum  <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">rowSums</span>(dt[, .SD, <span class="at" style="color: #657422;">.SDcols =</span> sel_cols])</span>
<span id="cb29-4"></span>
<span id="cb29-5"><span class="co" style="color: #5E5E5E;"># examine result</span></span>
<span id="cb29-6">dt[, row_total <span class="sc" style="color: #5E5E5E;">:</span><span class="er" style="color: #AD0000;">=</span> row_sum]</span>
<span id="cb29-7">dt[, rounding_error <span class="sc" style="color: #5E5E5E;">:</span><span class="er" style="color: #AD0000;">=</span> row_sum <span class="sc" style="color: #5E5E5E;">-</span> <span class="dv" style="color: #AD0000;">100</span>]</span>
<span id="cb29-8">dt[, .(Item, row_total, rounding_error)]</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>     Item row_total rounding_error
   &lt;char&gt;     &lt;num&gt;          &lt;num&gt;
1:     Q1     100.0            0.0
2:     Q2     100.2            0.2
3:     Q3      99.9           -0.1
4:     Q4     100.1            0.1
5:     Q5     100.1            0.1</code></pre>
</div>
</div>
<p>If we ignore the rounding error, it can introduce small but noticeable errors in the bar lengths in the chart. A simple remediation is to subtract the small errors from the neutral columns so that all rows sum to 100% exactly. The adjusted Neutrals are shown below.</p>
<div class="cell">
<details>
<summary>R code</summary>
<div class="sourceCode cell-code" id="cb31" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><span class="co" style="color: #5E5E5E;"># subtract error from neutral</span></span>
<span id="cb31-2">dt[, adjusted_neutral <span class="sc" style="color: #5E5E5E;">:</span><span class="er" style="color: #AD0000;">=</span> neutral <span class="sc" style="color: #5E5E5E;">-</span> rounding_error]</span>
<span id="cb31-3"></span>
<span id="cb31-4"><span class="co" style="color: #5E5E5E;"># examine the result</span></span>
<span id="cb31-5">dt[, .(Item, neutral, rounding_error, adjusted_neutral)]</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>     Item neutral rounding_error adjusted_neutral
   &lt;char&gt;   &lt;num&gt;          &lt;num&gt;            &lt;num&gt;
1:     Q1    25.8            0.0             25.8
2:     Q2    22.6            0.2             22.4
3:     Q3    16.1           -0.1             16.2
4:     Q4    32.3            0.1             32.2
5:     Q5    19.4            0.1             19.3</code></pre>
</div>
</div>
</section>
<section id="likert-input-1" class="level3">
<h3 class="anchored" data-anchor-id="likert-input-1"><code>likert()</code> input</h3>
<p>Replacing neutral with the adjusted neutral and deleting the temporary information columns yields the data structure I need for the summary percentage form:</p>
<div class="cell">
<details>
<summary>R code</summary>
<div class="sourceCode cell-code" id="cb33" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><span class="co" style="color: #5E5E5E;"># adjust neutral</span></span>
<span id="cb33-2">dt[, neutral <span class="sc" style="color: #5E5E5E;">:</span><span class="er" style="color: #AD0000;">=</span> adjusted_neutral]</span>
<span id="cb33-3"></span>
<span id="cb33-4"><span class="co" style="color: #5E5E5E;"># delete temporary information columns</span></span>
<span id="cb33-5">dt[, <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"row_total"</span>, <span class="st" style="color: #20794D;">"rounding_error"</span>, <span class="st" style="color: #20794D;">"adjusted_neutral"</span>) <span class="sc" style="color: #5E5E5E;">:</span><span class="er" style="color: #AD0000;">=</span> <span class="cn" style="color: #8f5902;">NULL</span>]</span>
<span id="cb33-6"></span>
<span id="cb33-7"><span class="co" style="color: #5E5E5E;"># examine the result</span></span>
<span id="cb33-8">dt[]</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>     Item str_disagree disagree neutral agree str_agree
   &lt;char&gt;        &lt;num&gt;    &lt;num&gt;   &lt;num&gt; &lt;num&gt;     &lt;num&gt;
1:     Q1          6.5      0.0    25.8  38.7      29.0
2:     Q2          6.5      6.5    22.4  45.2      19.4
3:     Q3          3.2      3.2    16.2  29.0      48.4
4:     Q4          0.0      6.5    32.2  38.7      22.6
5:     Q5          6.5      0.0    19.3  35.5      38.7</code></pre>
</div>
</div>
<p>Data structure:</p>
<ul>
<li>one row per question</li>
<li>first column is named <code>Item</code> and contains the question labels</li>
<li>remaining columns are named for the opinion levels in increasing order left to right</li>
<li>column values are the percentages of respondents choosing that option</li>
<li>the sum of row percentages is exactly 100%</li>
</ul>
<p>To prepare the data frame for graphing, I use the “edit the labels first” approach described earlier.</p>
<div class="cell">
<details>
<summary>R code</summary>
<div class="sourceCode cell-code" id="cb35" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><span class="co" style="color: #5E5E5E;"># recode the opinion options</span></span>
<span id="cb35-2"><span class="fu" style="color: #4758AB;">setnames_opinion_labels</span>(dt)</span>
<span id="cb35-3"></span>
<span id="cb35-4"><span class="co" style="color: #5E5E5E;"># recode the question labels</span></span>
<span id="cb35-5">dt[, Item <span class="sc" style="color: #5E5E5E;">:</span><span class="er" style="color: #AD0000;">=</span> question_labels]</span>
<span id="cb35-6"></span>
<span id="cb35-7"><span class="co" style="color: #5E5E5E;"># examine the result</span></span>
<span id="cb35-8">dt[]</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                   Item Strongly Disagree Disagree Neutral Agree Strongly Agree
                 &lt;char&gt;             &lt;num&gt;    &lt;num&gt;   &lt;num&gt; &lt;num&gt;          &lt;num&gt;
1:   Beyond the content               6.5      0.0    25.8  38.7           29.0
2:       Analyze errors               6.5      6.5    22.4  45.2           19.4
3:        Provide facts               3.2      3.2    16.2  29.0           48.4
4:      Develop writing               0.0      6.5    32.2  38.7           22.6
5: Independent learning               6.5      0.0    19.3  35.5           38.7</code></pre>
</div>
</div>
</section>
<section id="likert-output-1" class="level3">
<h3 class="anchored" data-anchor-id="likert-output-1"><code>likert()</code> output</h3>
<p>To operate on this data frame, we again use the <code>summary</code> argument of <code>likert()</code>. The result is a list similar to that produced when we operated on summary counts and the same familiar chart.</p>
<div class="cell" data-fig.asp="0.35">
<details>
<summary>R code</summary>
<div class="sourceCode cell-code" id="cb37" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><span class="co" style="color: #5E5E5E;"># create the likert list</span></span>
<span id="cb37-2">likert_list <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">likert</span>(<span class="at" style="color: #657422;">summary =</span> dt)</span>
<span id="cb37-3"></span>
<span id="cb37-4"><span class="co" style="color: #5E5E5E;"># examine its structure</span></span>
<span id="cb37-5"><span class="fu" style="color: #4758AB;">str</span>(likert_list)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>List of 5
 $ results :Classes 'data.table' and 'data.frame':  5 obs. of  6 variables:
  ..$ Item             : chr [1:5] "Beyond the content" "Analyze errors" "Provide facts" "Develop writing" ...
  ..$ Strongly Disagree: num [1:5] 6.5 6.5 3.2 0 6.5
  ..$ Disagree         : num [1:5] 0 6.5 3.2 6.5 0
  ..$ Neutral          : num [1:5] 25.8 22.4 16.2 32.2 19.3
  ..$ Agree            : num [1:5] 38.7 45.2 29 38.7 35.5
  ..$ Strongly Agree   : num [1:5] 29 19.4 48.4 22.6 38.7
  ..- attr(*, ".internal.selfref")=&lt;externalptr&gt; 
 $ items   : NULL
 $ grouping: NULL
 $ nlevels : num 5
 $ levels  : chr [1:5] "Strongly Disagree" "Disagree" "Neutral" "Agree" ...
 - attr(*, "class")= chr "likert"</code></pre>
</div>
<details>
<summary>R code</summary>
<div class="sourceCode cell-code" id="cb39" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><span class="co" style="color: #5E5E5E;"># 100% stacked bar chart</span></span>
<span id="cb39-2"><span class="fu" style="color: #4758AB;">likert_100_pct_bar</span>(likert_list)</span></code></pre></div>
</details>
<div class="cell-output-display">
<p><img src="https://graphdr.github.io/data-stories/posts\2022-02-13-survey-data-io\index_files\figure-html\unnamed-chunk-26-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="row-records" class="level2">
<h2 class="anchored" data-anchor-id="row-records">Row records</h2>
<p>In row-record form, everything we want to know about an individual is in one row, that is, a row-record for that individual. Thus the number of rows equals the number of respondents.</p>
<p>I made up a practice data set in row-record form with 31 rows and 6 columns. These are fictitious data I designed specifically to have the same summary characteristics as the published summary data used earlier.</p>
<p>Read the prepared data file in row-record form and view the data frame.</p>
<div class="cell">
<details>
<summary>R code</summary>
<div class="sourceCode cell-code" id="cb40" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><span class="co" style="color: #5E5E5E;"># read observed data</span></span>
<span id="cb40-2">dt <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">fread</span>(<span class="st" style="color: #20794D;">"case-study-2021-row-record.csv"</span>)</span>
<span id="cb40-3"></span>
<span id="cb40-4"><span class="co" style="color: #5E5E5E;"># examine the result</span></span>
<span id="cb40-5">dt[]</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>      obs    Q1    Q2    Q3    Q4    Q5
    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;
 1:     1     3     4     3     4     4
 2:     2     5     1     5     3     5
 3:     3     5     5     4     5     4
 4:     4     3     4     5     4     5
 5:     5     4     4     5     2     4
 6:     6     4     3     5     3     4
---                                    
26:    26     5     5     5     4     5
27:    27     5     2     3     4     1
28:    28     3     4     5     3     5
29:    29     3     3     4     3     4
30:    30     4     4     5     3     1
31:    31     4     4     5     5     5</code></pre>
</div>
</div>
<p>The first column is a fictitious respondent ID. The remaining columns represent responses to the survey questions. For basic charts like those shown here, all columns should be question responses, so I delete the ID. Though I don’t cover it here, additional non-question columns are allowed for grouping the results. See, for example, <span class="citation" data-cites="Mudge:2019">(Mudge 2019)</span>.</p>
<div class="cell">
<details>
<summary>R code</summary>
<div class="sourceCode cell-code" id="cb42" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><span class="co" style="color: #5E5E5E;"># delete the ID column</span></span>
<span id="cb42-2">dt[, obs <span class="sc" style="color: #5E5E5E;">:</span><span class="er" style="color: #AD0000;">=</span> <span class="cn" style="color: #8f5902;">NULL</span>]</span>
<span id="cb42-3"></span>
<span id="cb42-4"><span class="co" style="color: #5E5E5E;"># examine the result</span></span>
<span id="cb42-5">dt[]</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>       Q1    Q2    Q3    Q4    Q5
    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;
 1:     3     4     3     4     4
 2:     5     1     5     3     5
 3:     5     5     4     5     4
 4:     3     4     5     4     5
 5:     4     4     5     2     4
 6:     4     3     5     3     4
---                              
26:     5     5     5     4     5
27:     5     2     3     4     1
28:     3     4     5     3     5
29:     3     3     4     3     4
30:     4     4     5     3     1
31:     4     4     5     5     5</code></pre>
</div>
</div>
<section id="likert-input-2" class="level3">
<h3 class="anchored" data-anchor-id="likert-input-2"><code>likert()</code> input</h3>
<p>For the <code>likert()</code> function to accept data in this form, all question response columns must be factors with identical sets of levels. Reformatting the columns and checking the structure yields,</p>
<div class="cell">
<details>
<summary>R code</summary>
<div class="sourceCode cell-code" id="cb44" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><span class="co" style="color: #5E5E5E;"># reformat columns as factors</span></span>
<span id="cb44-2">sel_cols <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">names</span>(dt)</span>
<span id="cb44-3">dt[, <span class="fu" style="color: #4758AB;">c</span>(sel_cols) <span class="sc" style="color: #5E5E5E;">:</span><span class="er" style="color: #AD0000;">=</span> <span class="fu" style="color: #4758AB;">lapply</span>(.SD, <span class="cf" style="color: #003B4F;">function</span>(x) <span class="fu" style="color: #4758AB;">factor</span>(x, <span class="at" style="color: #657422;">levels =</span> <span class="dv" style="color: #AD0000;">1</span><span class="sc" style="color: #5E5E5E;">:</span><span class="dv" style="color: #AD0000;">5</span>)), .SDcols <span class="ot" style="color: #003B4F;">=</span> sel_cols]</span>
<span id="cb44-4"></span>
<span id="cb44-5"><span class="co" style="color: #5E5E5E;"># examine the result</span></span>
<span id="cb44-6">dt[]</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>        Q1     Q2     Q3     Q4     Q5
    &lt;fctr&gt; &lt;fctr&gt; &lt;fctr&gt; &lt;fctr&gt; &lt;fctr&gt;
 1:      3      4      3      4      4
 2:      5      1      5      3      5
 3:      5      5      4      5      4
 4:      3      4      5      4      5
 5:      4      4      5      2      4
 6:      4      3      5      3      4
---                                   
26:      5      5      5      4      5
27:      5      2      3      4      1
28:      3      4      5      3      5
29:      3      3      4      3      4
30:      4      4      5      3      1
31:      4      4      5      5      5</code></pre>
</div>
</div>
<p>Input data structure</p>
<ul>
<li>One row per respondent. The number of rows equals the number of respondents.</li>
<li>One column per question. The column name is the question label. The number of columns equals the number of survey questions.<br>
</li>
<li>Each column is a factor with an identical set of levels. The number of levels equals the number of answer options in the survey.</li>
<li>Column values are the encoded opinions of the respondent: 1 (Strongly Disagree), 2 (Disagree), 3 (Neutral), etc.</li>
</ul>
</section>
<section id="likert-output-2" class="level3">
<h3 class="anchored" data-anchor-id="likert-output-2"><code>likert()</code> output</h3>
<p>To operate on a row-record data frame, we assign it to the <code>items</code> argument of the <code>likert()</code> function. The result is again a list.</p>
<p>However, unlike the previous output lists, the data.table structure of the input has not been preserved. I use data.table syntax in subsequent operations, so I convert both <code>results</code> and <code>items</code> to data.tables.</p>
<div class="cell">
<details>
<summary>R code</summary>
<div class="sourceCode cell-code" id="cb46" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><span class="co" style="color: #5E5E5E;"># create likert list </span></span>
<span id="cb46-2">likert_list <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">likert</span>(<span class="at" style="color: #657422;">items =</span> dt)</span>
<span id="cb46-3"></span>
<span id="cb46-4"><span class="co" style="color: #5E5E5E;"># convert output data frames to data.tables</span></span>
<span id="cb46-5"><span class="fu" style="color: #4758AB;">setDT</span>(likert_list<span class="sc" style="color: #5E5E5E;">$</span>results)</span>
<span id="cb46-6"><span class="fu" style="color: #4758AB;">setDT</span>(likert_list<span class="sc" style="color: #5E5E5E;">$</span>items)</span>
<span id="cb46-7"></span>
<span id="cb46-8"><span class="co" style="color: #5E5E5E;"># examine the result</span></span>
<span id="cb46-9"><span class="fu" style="color: #4758AB;">str</span>(likert_list)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>List of 6
 $ results :Classes 'data.table' and 'data.frame':  5 obs. of  6 variables:
  ..$ Item: chr [1:5] "Q1" "Q2" "Q3" "Q4" ...
  ..$ 1   : num [1:5] 6.45 6.45 3.23 0 6.45
  ..$ 2   : num [1:5] 0 6.45 3.23 6.45 0
  ..$ 3   : num [1:5] 25.8 22.6 16.1 32.3 19.4
  ..$ 4   : num [1:5] 38.7 45.2 29 38.7 35.5
  ..$ 5   : num [1:5] 29 19.4 48.4 22.6 38.7
  ..- attr(*, ".internal.selfref")=&lt;externalptr&gt; 
 $ items   :Classes 'data.table' and 'data.frame':  31 obs. of  5 variables:
  ..$ Q1: Factor w/ 5 levels "1","2","3","4",..: 3 5 5 3 4 4 3 1 4 5 ...
  ..$ Q2: Factor w/ 5 levels "1","2","3","4",..: 4 1 5 4 4 3 2 5 5 4 ...
  ..$ Q3: Factor w/ 5 levels "1","2","3","4",..: 3 5 4 5 5 5 4 4 4 5 ...
  ..$ Q4: Factor w/ 5 levels "1","2","3","4",..: 4 3 5 4 2 3 4 3 5 5 ...
  ..$ Q5: Factor w/ 5 levels "1","2","3","4",..: 4 5 4 5 4 4 4 3 4 3 ...
  ..- attr(*, ".internal.selfref")=&lt;externalptr&gt; 
 $ grouping: NULL
 $ factors : NULL
 $ nlevels : int 5
 $ levels  : chr [1:5] "1" "2" "3" "4" ...
 - attr(*, "class")= chr "likert"</code></pre>
</div>
</div>
<p>The components of the list are:</p>
<dl>
<dt><code>results</code></dt>
<dd>
Data frame. Percentage of responses by question, opinion level, and group.
</dd>
<dt><code>items</code></dt>
<dd>
Data frame. Copy of original row-record input.
</dd>
<dt><code>grouping</code></dt>
<dd>
Copy of original grouping vector that subsets results (NULL in this example).
</dd>
<dt><code>factors</code></dt>
<dd>
Copy of original vector matching columns to factors (NULL in this example).
</dd>
<dt><code>nlevels</code></dt>
<dd>
Integer. Number of opinion levels used in the calculations.
</dd>
<dt><code>levels</code></dt>
<dd>
Character. Ordered vector of opinion level labels.
</dd>
</dl>
</section>
<section id="draft-chart" class="level3">
<h3 class="anchored" data-anchor-id="draft-chart">Draft chart</h3>
<p>With row-record data, the plot function requires both <code>results</code> and <code>items</code> from the output list. The chart is familiar, but the opinion labels are now the integers used to encode the survey results.</p>
<div class="cell" data-fig.asp="0.35">
<details>
<summary>R code</summary>
<div class="sourceCode cell-code" id="cb48" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><span class="fu" style="color: #4758AB;">likert_100_pct_bar</span>(likert_list)</span></code></pre></div>
</details>
<div class="cell-output-display">
<p><img src="https://graphdr.github.io/data-stories/posts\2022-02-13-survey-data-io\index_files\figure-html\unnamed-chunk-31-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="legend-key-1" class="level3">
<h3 class="anchored" data-anchor-id="legend-key-1">Legend key</h3>
<p>As before, the legend key is edited via the column names of <code>likert_list$results</code>. Note the corresponding changes in the likert list and chart.</p>
<div class="cell" data-fig.asp="0.35">
<details>
<summary>R code</summary>
<div class="sourceCode cell-code" id="cb49" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><span class="co" style="color: #5E5E5E;"># recode the opinion options</span></span>
<span id="cb49-2"><span class="fu" style="color: #4758AB;">setnames</span>(likert_list<span class="sc" style="color: #5E5E5E;">$</span>results, </span>
<span id="cb49-3">         <span class="at" style="color: #657422;">old =</span> <span class="fu" style="color: #4758AB;">as.character</span>(<span class="dv" style="color: #AD0000;">1</span><span class="sc" style="color: #5E5E5E;">:</span><span class="dv" style="color: #AD0000;">5</span>), </span>
<span id="cb49-4">         <span class="at" style="color: #657422;">new =</span> opinion_labels, </span>
<span id="cb49-5">         <span class="at" style="color: #657422;">skip_absent =</span> <span class="cn" style="color: #8f5902;">TRUE</span>)</span>
<span id="cb49-6"></span>
<span id="cb49-7"><span class="co" style="color: #5E5E5E;"># examine the result</span></span>
<span id="cb49-8"><span class="fu" style="color: #4758AB;">str</span>(likert_list)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>List of 6
 $ results :Classes 'data.table' and 'data.frame':  5 obs. of  6 variables:
  ..$ Item             : chr [1:5] "Q1" "Q2" "Q3" "Q4" ...
  ..$ Strongly Disagree: num [1:5] 6.45 6.45 3.23 0 6.45
  ..$ Disagree         : num [1:5] 0 6.45 3.23 6.45 0
  ..$ Neutral          : num [1:5] 25.8 22.6 16.1 32.3 19.4
  ..$ Agree            : num [1:5] 38.7 45.2 29 38.7 35.5
  ..$ Strongly Agree   : num [1:5] 29 19.4 48.4 22.6 38.7
  ..- attr(*, ".internal.selfref")=&lt;externalptr&gt; 
 $ items   :Classes 'data.table' and 'data.frame':  31 obs. of  5 variables:
  ..$ Q1: Factor w/ 5 levels "1","2","3","4",..: 3 5 5 3 4 4 3 1 4 5 ...
  ..$ Q2: Factor w/ 5 levels "1","2","3","4",..: 4 1 5 4 4 3 2 5 5 4 ...
  ..$ Q3: Factor w/ 5 levels "1","2","3","4",..: 3 5 4 5 5 5 4 4 4 5 ...
  ..$ Q4: Factor w/ 5 levels "1","2","3","4",..: 4 3 5 4 2 3 4 3 5 5 ...
  ..$ Q5: Factor w/ 5 levels "1","2","3","4",..: 4 5 4 5 4 4 4 3 4 3 ...
  ..- attr(*, ".internal.selfref")=&lt;externalptr&gt; 
 $ grouping: NULL
 $ factors : NULL
 $ nlevels : int 5
 $ levels  : chr [1:5] "1" "2" "3" "4" ...
 - attr(*, "class")= chr "likert"</code></pre>
</div>
<details>
<summary>R code</summary>
<div class="sourceCode cell-code" id="cb51" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><span class="co" style="color: #5E5E5E;"># create the chart</span></span>
<span id="cb51-2"><span class="fu" style="color: #4758AB;">likert_100_pct_bar</span>(likert_list)</span></code></pre></div>
</details>
<div class="cell-output-display">
<p><img src="https://graphdr.github.io/data-stories/posts\2022-02-13-survey-data-io\index_files\figure-html\unnamed-chunk-32-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="question-labels-1" class="level3">
<h3 class="anchored" data-anchor-id="question-labels-1">Question labels</h3>
<p>With row-record data, both <code>results</code> and <code>items</code> data frames must be revised to edit the question labels. Note the corresponding changes in the likert list and chart.</p>
<div class="cell" data-fig.asp="0.35">
<details>
<summary>R code</summary>
<div class="sourceCode cell-code" id="cb52" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><span class="co" style="color: #5E5E5E;"># recode Item column of $results</span></span>
<span id="cb52-2">likert_list<span class="sc" style="color: #5E5E5E;">$</span>results[, Item <span class="sc" style="color: #5E5E5E;">:</span><span class="er" style="color: #AD0000;">=</span> question_labels]</span>
<span id="cb52-3"></span>
<span id="cb52-4"><span class="co" style="color: #5E5E5E;"># recode column names of $items</span></span>
<span id="cb52-5"><span class="fu" style="color: #4758AB;">setnames</span>(likert_list<span class="sc" style="color: #5E5E5E;">$</span>items, </span>
<span id="cb52-6">         <span class="at" style="color: #657422;">old =</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"Q1"</span>, <span class="st" style="color: #20794D;">"Q2"</span>, <span class="st" style="color: #20794D;">"Q3"</span>, <span class="st" style="color: #20794D;">"Q4"</span>, <span class="st" style="color: #20794D;">"Q5"</span>), </span>
<span id="cb52-7">         <span class="at" style="color: #657422;">new =</span> question_labels, </span>
<span id="cb52-8">         <span class="at" style="color: #657422;">skip_absent =</span> <span class="cn" style="color: #8f5902;">TRUE</span>)</span>
<span id="cb52-9"></span>
<span id="cb52-10"><span class="co" style="color: #5E5E5E;"># examine the result</span></span>
<span id="cb52-11"><span class="fu" style="color: #4758AB;">str</span>(likert_list)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>List of 6
 $ results :Classes 'data.table' and 'data.frame':  5 obs. of  6 variables:
  ..$ Item             : chr [1:5] "Beyond the content" "Analyze errors" "Provide facts" "Develop writing" ...
  ..$ Strongly Disagree: num [1:5] 6.45 6.45 3.23 0 6.45
  ..$ Disagree         : num [1:5] 0 6.45 3.23 6.45 0
  ..$ Neutral          : num [1:5] 25.8 22.6 16.1 32.3 19.4
  ..$ Agree            : num [1:5] 38.7 45.2 29 38.7 35.5
  ..$ Strongly Agree   : num [1:5] 29 19.4 48.4 22.6 38.7
  ..- attr(*, ".internal.selfref")=&lt;externalptr&gt; 
 $ items   :Classes 'data.table' and 'data.frame':  31 obs. of  5 variables:
  ..$ Beyond the content  : Factor w/ 5 levels "1","2","3","4",..: 3 5 5 3 4 4 3 1 4 5 ...
  ..$ Analyze errors      : Factor w/ 5 levels "1","2","3","4",..: 4 1 5 4 4 3 2 5 5 4 ...
  ..$ Provide facts       : Factor w/ 5 levels "1","2","3","4",..: 3 5 4 5 5 5 4 4 4 5 ...
  ..$ Develop writing     : Factor w/ 5 levels "1","2","3","4",..: 4 3 5 4 2 3 4 3 5 5 ...
  ..$ Independent learning: Factor w/ 5 levels "1","2","3","4",..: 4 5 4 5 4 4 4 3 4 3 ...
  ..- attr(*, ".internal.selfref")=&lt;externalptr&gt; 
 $ grouping: NULL
 $ factors : NULL
 $ nlevels : int 5
 $ levels  : chr [1:5] "1" "2" "3" "4" ...
 - attr(*, "class")= chr "likert"</code></pre>
</div>
<details>
<summary>R code</summary>
<div class="sourceCode cell-code" id="cb54" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><span class="co" style="color: #5E5E5E;"># create the chart</span></span>
<span id="cb54-2"><span class="fu" style="color: #4758AB;">likert_100_pct_bar</span>(likert_list)</span></code></pre></div>
</details>
<div class="cell-output-display">
<p><img src="https://graphdr.github.io/data-stories/posts\2022-02-13-survey-data-io\index_files\figure-html\unnamed-chunk-33-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="or-edit-the-labels-first-1" class="level3">
<h3 class="anchored" data-anchor-id="or-edit-the-labels-first-1">Or edit the labels first</h3>
<p>As before, we have an alternative approach: one can produce the same result by editing the opinion labels and question labels of the data frame before submitting it to likert(). Question labels are substituted for the column names. Opinion levels (as text) are substituted for the encoded integers, i.e., 1 = Strongly Disagree through 5 = Strongly Agree.</p>
<p>To illustrate, I start with a fresh row-record data set.</p>
<div class="cell">
<details>
<summary>R code</summary>
<div class="sourceCode cell-code" id="cb55" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><span class="co" style="color: #5E5E5E;"># read prepared data</span></span>
<span id="cb55-2">dt <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">fread</span>(<span class="st" style="color: #20794D;">"case-study-2021-row-record.csv"</span>)</span>
<span id="cb55-3"></span>
<span id="cb55-4"><span class="co" style="color: #5E5E5E;"># delete the ID column</span></span>
<span id="cb55-5">dt <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">subset</span>(dt, <span class="at" style="color: #657422;">select =</span> <span class="sc" style="color: #5E5E5E;">-</span><span class="fu" style="color: #4758AB;">c</span>(obs))</span>
<span id="cb55-6"></span>
<span id="cb55-7"><span class="co" style="color: #5E5E5E;"># recode the question labels in the column names</span></span>
<span id="cb55-8"><span class="fu" style="color: #4758AB;">setnames</span>(dt, </span>
<span id="cb55-9">         <span class="at" style="color: #657422;">old =</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"Q1"</span>, <span class="st" style="color: #20794D;">"Q2"</span>, <span class="st" style="color: #20794D;">"Q3"</span>, <span class="st" style="color: #20794D;">"Q4"</span>, <span class="st" style="color: #20794D;">"Q5"</span>), </span>
<span id="cb55-10">         <span class="at" style="color: #657422;">new =</span> question_labels, </span>
<span id="cb55-11">         <span class="at" style="color: #657422;">skip_absent =</span> <span class="cn" style="color: #8f5902;">TRUE</span>)</span>
<span id="cb55-12"></span>
<span id="cb55-13"><span class="co" style="color: #5E5E5E;"># recode integer values with opinion options  </span></span>
<span id="cb55-14">sel_cols <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">names</span>(dt)</span>
<span id="cb55-15">dt[, (sel_cols) <span class="sc" style="color: #5E5E5E;">:</span><span class="er" style="color: #AD0000;">=</span> <span class="fu" style="color: #4758AB;">lapply</span>(.SD, <span class="cf" style="color: #003B4F;">function</span>(x) <span class="fu" style="color: #4758AB;">fcase</span>(</span>
<span id="cb55-16">  x <span class="sc" style="color: #5E5E5E;">==</span> <span class="dv" style="color: #AD0000;">1</span>, opinion_labels[<span class="dv" style="color: #AD0000;">1</span>],</span>
<span id="cb55-17">  x <span class="sc" style="color: #5E5E5E;">==</span> <span class="dv" style="color: #AD0000;">2</span>, opinion_labels[<span class="dv" style="color: #AD0000;">2</span>],</span>
<span id="cb55-18">  x <span class="sc" style="color: #5E5E5E;">==</span> <span class="dv" style="color: #AD0000;">3</span>, opinion_labels[<span class="dv" style="color: #AD0000;">3</span>],</span>
<span id="cb55-19">  x <span class="sc" style="color: #5E5E5E;">==</span> <span class="dv" style="color: #AD0000;">4</span>, opinion_labels[<span class="dv" style="color: #AD0000;">4</span>],</span>
<span id="cb55-20">  x <span class="sc" style="color: #5E5E5E;">==</span> <span class="dv" style="color: #AD0000;">5</span>, opinion_labels[<span class="dv" style="color: #AD0000;">5</span>])),</span>
<span id="cb55-21">  .SDcols <span class="ot" style="color: #003B4F;">=</span> sel_cols]</span>
<span id="cb55-22"></span>
<span id="cb55-23"><span class="co" style="color: #5E5E5E;"># convert columns to factors  </span></span>
<span id="cb55-24">dt <span class="ot" style="color: #003B4F;">&lt;-</span> dt[, <span class="fu" style="color: #4758AB;">lapply</span>(.SD, <span class="cf" style="color: #003B4F;">function</span>(x) <span class="fu" style="color: #4758AB;">factor</span>(x, <span class="at" style="color: #657422;">levels =</span> opinion_labels)), .SDcols <span class="ot" style="color: #003B4F;">=</span> sel_cols]</span>
<span id="cb55-25"></span>
<span id="cb55-26"><span class="co" style="color: #5E5E5E;"># examine the result</span></span>
<span id="cb55-27">dt[]</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>    Beyond the content    Analyze errors  Provide facts Develop writing
                &lt;fctr&gt;            &lt;fctr&gt;         &lt;fctr&gt;          &lt;fctr&gt;
 1:            Neutral             Agree        Neutral           Agree
 2:     Strongly Agree Strongly Disagree Strongly Agree         Neutral
 3:     Strongly Agree    Strongly Agree          Agree  Strongly Agree
 4:            Neutral             Agree Strongly Agree           Agree
 5:              Agree             Agree Strongly Agree        Disagree
 6:              Agree           Neutral Strongly Agree         Neutral
---                                                                    
26:     Strongly Agree    Strongly Agree Strongly Agree           Agree
27:     Strongly Agree          Disagree        Neutral           Agree
28:            Neutral             Agree Strongly Agree         Neutral
29:            Neutral           Neutral          Agree         Neutral
30:              Agree             Agree Strongly Agree         Neutral
31:              Agree             Agree Strongly Agree  Strongly Agree
    Independent learning
                  &lt;fctr&gt;
 1:                Agree
 2:       Strongly Agree
 3:                Agree
 4:       Strongly Agree
 5:                Agree
 6:                Agree
---                     
26:       Strongly Agree
27:    Strongly Disagree
28:       Strongly Agree
29:                Agree
30:    Strongly Disagree
31:       Strongly Agree</code></pre>
</div>
</div>
<p>Input to <code>likert()</code> produces the familiar chart.</p>
<div class="cell" data-fig.asp="0.35">
<details>
<summary>R code</summary>
<div class="sourceCode cell-code" id="cb57" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><span class="co" style="color: #5E5E5E;"># create the likert list</span></span>
<span id="cb57-2">likert_list <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">likert</span>(<span class="at" style="color: #657422;">items =</span> dt)</span>
<span id="cb57-3"></span>
<span id="cb57-4"><span class="co" style="color: #5E5E5E;"># examine the result</span></span>
<span id="cb57-5"><span class="fu" style="color: #4758AB;">str</span>(likert_list)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>List of 6
 $ results :'data.frame':   5 obs. of  6 variables:
  ..$ Item             : chr [1:5] "Beyond the content" "Analyze errors" "Provide facts" "Develop writing" ...
  ..$ Strongly Disagree: num [1:5] 6.45 6.45 3.23 0 6.45
  ..$ Disagree         : num [1:5] 0 6.45 3.23 6.45 0
  ..$ Neutral          : num [1:5] 25.8 22.6 16.1 32.3 19.4
  ..$ Agree            : num [1:5] 38.7 45.2 29 38.7 35.5
  ..$ Strongly Agree   : num [1:5] 29 19.4 48.4 22.6 38.7
 $ items   :'data.frame':   31 obs. of  5 variables:
  ..$ Beyond the content  : Factor w/ 5 levels "Strongly Disagree",..: 3 5 5 3 4 4 3 1 4 5 ...
  ..$ Analyze errors      : Factor w/ 5 levels "Strongly Disagree",..: 4 1 5 4 4 3 2 5 5 4 ...
  ..$ Provide facts       : Factor w/ 5 levels "Strongly Disagree",..: 3 5 4 5 5 5 4 4 4 5 ...
  ..$ Develop writing     : Factor w/ 5 levels "Strongly Disagree",..: 4 3 5 4 2 3 4 3 5 5 ...
  ..$ Independent learning: Factor w/ 5 levels "Strongly Disagree",..: 4 5 4 5 4 4 4 3 4 3 ...
 $ grouping: NULL
 $ factors : NULL
 $ nlevels : int 5
 $ levels  : chr [1:5] "Strongly Disagree" "Disagree" "Neutral" "Agree" ...
 - attr(*, "class")= chr "likert"</code></pre>
</div>
<details>
<summary>R code</summary>
<div class="sourceCode cell-code" id="cb59" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><span class="co" style="color: #5E5E5E;"># create the chart</span></span>
<span id="cb59-2"><span class="fu" style="color: #4758AB;">likert_100_pct_bar</span>(likert_list)</span></code></pre></div>
</details>
<div class="cell-output-display">
<p><img src="https://graphdr.github.io/data-stories/posts\2022-02-13-survey-data-io\index_files\figure-html\unnamed-chunk-35-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="data-table" class="level3">
<h3 class="anchored" data-anchor-id="data-table">Data table</h3>
<p>The <code>results</code> component can also be used to construct a summary data table.</p>
<div class="cell">
<details>
<summary>R code</summary>
<div class="sourceCode cell-code" id="cb60" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1">likert_list<span class="sc" style="color: #5E5E5E;">$</span>results</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                  Item Strongly Disagree Disagree  Neutral    Agree
1   Beyond the content          6.451613 0.000000 25.80645 38.70968
2       Analyze errors          6.451613 6.451613 22.58065 45.16129
3        Provide facts          3.225806 3.225806 16.12903 29.03226
4      Develop writing          0.000000 6.451613 32.25806 38.70968
5 Independent learning          6.451613 0.000000 19.35484 35.48387
  Strongly Agree
1       29.03226
2       19.35484
3       48.38710
4       22.58065
5       38.70968</code></pre>
</div>
</div>
<p>Rounding the digits, we produce a publication-ready table. I’m assuming the abbreviated question labels are OK—if not, each could be replaced with its complete assertion. In this form, the rows of the table are in the same order as the rows of the chart—a structure that could be useful to the reader.</p>
<div class="cell">
<div class="cell-output-display">
<table class="table table-sm table-striped">
<colgroup>
<col style="width: 27%">
<col style="width: 23%">
<col style="width: 11%">
<col style="width: 10%">
<col style="width: 7%">
<col style="width: 19%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Item</th>
<th style="text-align: right;">Strongly Disagree</th>
<th style="text-align: right;">Disagree</th>
<th style="text-align: right;">Neutral</th>
<th style="text-align: right;">Agree</th>
<th style="text-align: right;">Strongly Agree</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Beyond the content</td>
<td style="text-align: right;">6.5</td>
<td style="text-align: right;">0.0</td>
<td style="text-align: right;">25.8</td>
<td style="text-align: right;">38.7</td>
<td style="text-align: right;">29.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">Analyze errors</td>
<td style="text-align: right;">6.5</td>
<td style="text-align: right;">6.5</td>
<td style="text-align: right;">22.6</td>
<td style="text-align: right;">45.2</td>
<td style="text-align: right;">19.4</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Provide facts</td>
<td style="text-align: right;">3.2</td>
<td style="text-align: right;">3.2</td>
<td style="text-align: right;">16.1</td>
<td style="text-align: right;">29.0</td>
<td style="text-align: right;">48.4</td>
</tr>
<tr class="even">
<td style="text-align: left;">Develop writing</td>
<td style="text-align: right;">0.0</td>
<td style="text-align: right;">6.5</td>
<td style="text-align: right;">32.3</td>
<td style="text-align: right;">38.7</td>
<td style="text-align: right;">22.6</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Independent learning</td>
<td style="text-align: right;">6.5</td>
<td style="text-align: right;">0.0</td>
<td style="text-align: right;">19.4</td>
<td style="text-align: right;">35.5</td>
<td style="text-align: right;">38.7</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>The values in this table were computed by likert from the fictitious row-record data. The numbers agree with the source data table.</p>
</section>
</section>
<section id="comments" class="level2">
<h2 class="anchored" data-anchor-id="comments">Comments</h2>
<p>To comment, a reader has to have a <a href="https://github.com/">GitHub</a> account. Use the <em>Sign in with GitHub</em> button and give permission to the utterances app.</p>
</section>


<div id="quarto-appendix" class="default"><section id="acknowledgments" class="level2 appendix"><h2 class="quarto-appendix-heading">Acknowledgments</h2><div class="quarto-appendix-contents">

<p><strong>R and R packages</strong></p>
<p><a href="https://CRAN.R-project.org/"><code>R</code></a> (version 4.1.2, 2021–11–01)<br>
<a href="https://CRAN.R-project.org/package=data.table"><code>data.table</code></a> for manipulating data (version 1.14.2)<br>
<a href="https://CRAN.R-project.org/package=distill"><code>distill</code></a> for creating the post (version 1.3)<br>
<a href="https://CRAN.R-project.org/package=ggplot2"><code>ggplot2</code></a> for fine-tuning the charts (version 3.3.5)<br>
<a href="https://CRAN.R-project.org/package=likert"><code>likert</code></a> for manipulating and plotting Likert-style data (version 1.3.6)</p>



</div></section><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Chanenson:2021" class="csl-entry">
Chanenson, Jake. 2021. <span>“<span>On Likert Scales In R</span>.”</span> <a href="https://jakec007.github.io/2021-06-23-R-likert/">https://jakec007.github.io/2021-06-23-R-likert/</a>.
</div>
<div id="ref-Maxworth:2021" class="csl-entry">
Maxworth, Ashanthi. 2021. <span>“<span class="nocase">Looking ahead: Advancing engineering education through case studies in introductory courses</span>.”</span> <em>Advances in Engineering Education</em> 9 (4): 1–9. <a href="https://drive.google.com/file/d/1r3w6gQfCHvnahXuyKD9Yeb1kYYWHd2cE/view?usp=sharing">https://drive.google.com/file/d/1r3w6gQfCHvnahXuyKD9Yeb1kYYWHd2cE/view?usp=sharing</a>.
</div>
<div id="ref-Mudge:2019" class="csl-entry">
Mudge, Laura. 2019. <span>“<span class="nocase">Data visualization for Likert questions</span>.”</span> <a href="https://lmudge13.github.io/sample_code/likert_graphs.html">https://lmudge13.github.io/sample_code/likert_graphs.html</a>.
</div>
</div></section></div> ]]></description>
  <category>R</category>
  <guid>https://graphdr.github.io/data-stories/posts/2022-02-13-survey-data-io/index.html</guid>
  <pubDate>Sun, 13 Feb 2022 05:00:00 GMT</pubDate>
  <media:content url="https://graphdr.github.io/data-stories//posts/2022-02-13-survey-data-io/thumbnail.png" medium="image" type="image/png" height="94" width="144"/>
</item>
</channel>
</rss>
