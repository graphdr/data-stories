<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-0.9.426">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Richard Layton">
<meta name="dcterms.date" content="2022-03-09">
<meta name="description" content="Using the scales and space arguments of facet_grid() to manage panel heights of faceted charts when categories are not independent.">

<title>Layton R Blog - Facets that are not small multiples</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>

<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link id="quarto-text-highlighting-styles" href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Layton R Blog</span>
  </a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html">Home</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../license.html">License</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html">About</a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/graphdr/data-stories"><i class="bi bi-github" role="img">
</i> 
 </a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="../../index.xml"><i class="bi bi-rss" role="img">
</i> 
 </a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Facets that are not small multiples</h1>
  <div class="quarto-categories">
    <div class="quarto-category">ggplot2</div>
    <div class="quarto-category">R</div>
  </div>
  </div>

<div>
  <div class="description">
    <p>Using the scales and space arguments of facet_grid() to manage panel heights of faceted charts when categories are not independent.</p>
  </div>
</div>




<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Richard Layton </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">March 9, 2022</p>
    </div>
  </div>
    
  </div>
  

</header>

<blockquote class="blockquote">
<p>Summary. For data structures having two categorical variables and one quantitative variable, this post illustrates how category independence or dependence influences chart design. Graphs with independent categories (multiway data) are easily created in ggplot2 with the <code>facet_wrap()</code> function; data with dependent categories require <code>facet_grid()</code> with its <code>scales</code> and <code>space</code> arguments to treat unequal vertical scales.</p>
</blockquote>
<p><em>Small multiple</em> design is a good design choice for many data structures. To facilitate visual comparisons, every small-multiple frame (variously called panels, facets, or subplots) has identical scales.</p>
<blockquote class="blockquote">
<p>Small multiples resemble the frames of a movie: a series of graphics, showing the same combination of variables, indexed by changes in another variable. <span class="citation" data-cites="Tufte:1983">[@Tufte:1983, 170]</span></p>
</blockquote>
<p><em>Multiway data</em>—a data structure comprising two independent categorical variables and one quantitative response variable—is well-matched to small multiple design.</p>
<blockquote class="blockquote">
<p>What distinguishes multiway data is the cross-classification of the categorical variables; there is a value of the response for each combination of levels of the two categorical variables <span class="citation" data-cites="Cleveland:1993">[@Cleveland:1993, 303]</span>.</p>
</blockquote>
<p>However, if the categories happen to be <em>dependent</em>, the data are not multiway and the small multiple design fails. Having come across data of this type in a recent article, I thought it would be interesting to illustrate, given one quantitative variable and two categorical variables, how category independence or dependence influences chart design.</p>
<p>I start with a multiway data set and point out that, as a small-multiple design, the panels share common scales. In ggplot2, small multiples are usually created using <code>facet_wrap()</code>.</p>
<p>The second example has data with dependent categories. The panels share a common, horizontal, quantitative scale but have different category scales, yielding facets that are not small multiples. I use <code>facet_grid()</code> with its <code>scales</code> and <code>space</code> arguments to treat the unequal vertical scales.</p>
<p>The R code for the post is listed under the “R code” pointers.</p>
<div class="cell">

</div>
<section id="multiway-example" class="level2">
<h2 class="anchored" data-anchor-id="multiway-example">Multiway example</h2>
<p>The literal textbook example of multiway data and chart design is the livestock chart by Cleveland <span class="citation" data-cites="Cleveland:1993">[-@Cleveland:1993, 303]</span>. The data set contains counts of 5 types of farm animals in 26 countries in 1967. The independent categories are country and animal type; the quantitative variable is the count.</p>
<p>I obtained a reproduction of the data from <span class="citation" data-cites="UCLA:2021">[@UCLA:2021]</span> and saved it as a CSV file in the blog data directory.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>     livestock_type        country    count
             &lt;char&gt;         &lt;char&gt;    &lt;num&gt;
  1:         Cattle        Albania   478000
  2:         Cattle        Austria  2536000
  3:         Cattle        Belgium  3246000
  4:         Cattle       Bulgaria  1796000
  5:         Cattle Czechoslovakia  5131000
 ---                                       
126:          Sheep    Switzerland   336000
127:          Sheep         Turkey 70093000
128:          Sheep United Kingdom 32888000
129:          Sheep  Russia et al. 21000000
130:          Sheep     Yugoslavia  7384000</code></pre>
</div>
</div>
<p>The countries are assigned to the rows such that the median count by country increases from bottom to top. The livestock are assigned to the panels such that median count by livestock type increases in <em>graphical order:</em> increasing from left to right and from bottom to top. The logarithm of counts is used for the quantitative scale counts vary by more than four powers of 10.</p>
<div class="cell" data-fig.asp="1.2">
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Typical of small multiple charts in general, all five panels have identical horizontal scales (the count) and identical vertical axes (countries). It follows that the size and aspect ratio of each panel are also identical.</p>
</section>
<section id="when-categories-are-dependent" class="level2">
<h2 class="anchored" data-anchor-id="when-categories-are-dependent">When categories are dependent</h2>
<p>The data set that inspired this post is from an article on a creative expression assignment used in a first-year engineering course <span class="citation" data-cites="Chambers+Reid:2021">[@Chambers+Reid:2021]</span>. In response to COVID-19, the course had transitioned from a highly interactive, in-person experience to an asynchronous, online model.</p>
<blockquote class="blockquote">
<p>The instructors designed an assignment to encourage students to creatively express how the course interruption and transition online was affecting them. The assignment encouraged complete freedom of expression and choice of media.</p>
</blockquote>
<p>A data table in the article reports how the student work is coded: 28 creative genres (prose, lyrics, music performance, dance, YouTube, etc.) grouped into 6 media categories (writing, performance, video, graphics, etc.). The quantitative variable is the count of encodings by genre.</p>
<p>Some submissions covered multiple media and genres, for example, an original song in a video would be coded as both. Thus the total of the <code>count</code> column (304 encodings) exceeds the number of submissions (N = 265). The <code>percent</code> column is a derived variable that reports the count as a percentage of N. The sum of the <code>percent</code> column is therefore greater than 100%.</p>
<p>The data are available in the blog data directory.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>         medium                 genre count percent
         &lt;char&gt;                &lt;char&gt; &lt;int&gt;   &lt;num&gt;
 1:     Writing                 Prose     6     2.3
 2:     Writing                 Essay    32    12.1
 3:     Writing              Word art     6     2.3
 4:     Writing    Poetry (not haiku)    32    12.1
 5:     Writing                 Haiku     4     1.5
 6:       Music                Lyrics     3     1.1
 7:       Music              Playlist     3     1.1
 8: Performance Music from instrument     6     2.3
 9: Performance  Performance of music     6     2.3
10: Performance                 Dance     2     0.8
11: Performance           Spoken word     2     0.8
12:   Sculpture      Arranged objects     6     2.3
13:   Sculpture             Sculpture     2     0.8
14:   Sculpture                  Lego     2     0.8
15:       Video                TikTok     7     2.6
16:       Video               YouTube     4     1.5
17:       Video            Short-form     9     3.4
18:       Video                 Music     3     1.1
19:       Video           Spoken word     5     1.9
20:    Graphics               Collage    13     4.9
21:    Graphics              Painting    18     6.8
22:    Graphics       Drawing by hand    58    21.9
23:    Graphics   Drawing by computer    10     3.8
24:    Graphics           Photography    15     5.7
25:    Graphics               Cartoon    18     6.8
26:    Graphics                 Emoji     6     2.3
27:    Graphics                  Meme    22     8.3
28:    Graphics            Web design     4     1.5
         medium                 genre count percent</code></pre>
</div>
</div>
<p>The graph I have in mind would have media type assigned to rows and media category assigned to panels. Unlike the livestock example, however, the categorical variables in these data are not independent. For example, web design is associated only with graphics, essay is associated only with writing, etc.</p>
<p>In my first attempt, I use <code>facet_wrap()</code> like I did with the livestock data. The visual problem is obvious…every row has a data marker in one panel only. Because the categories are not independent, the small-multiple design fails.</p>
<div class="cell" data-fig.asp="1.6">
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The <code>scales = "free_y"</code> argument of <code>facet_wrap()</code> replaces the common y-scale with only those row labels associated with a panel. I also use the <code>ncol</code> argument to stack the panels in one column with all rows labels aligned on the left. This graph has the essential layout I had in mind—a common quantitative scale but different vertical scales, yielding facets that are not small multiples.</p>
<div class="cell" data-fig.asp="1.5">
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Because <code>facet_wrap()</code> creates panels of equal height, the rows in this case are unequally spaced.</p>
<p>I switch to <code>facet_grid()</code> to space the rows equally in panels of unequal height. The <code>space = "free_y"</code> argument is added to make the panel height proportional to the length of the y scale.</p>
<div class="cell" data-fig.asp="1">
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="editing-the-chart" class="level2">
<h2 class="anchored" data-anchor-id="editing-the-chart">Editing the chart</h2>
<p>While the overall layout above is what I want, I would prefer to move the panel labels from the right-hand side to the top of each panel. I could not find a way to do that, so I removed the right-hand label and wrote the media label inside the panel. I edited some other aesthetics as well.</p>
<div class="cell" data-fig.asp="1">
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Features of the graph</p>
<ul>
<li><code>facet_grid()</code> as shown earlier for panels of unequal height with rows equally spaced.</li>
<li><code>geom_text()</code> for panel labels, vertically centered.</li>
<li><code>sec_axis()</code> for a secondary scale along the top of the chart showing counts of genre encodings from the data table.</li>
<li><code>theme_light()</code> for gray lines on white background to focus attention on the data.</li>
<li>All text is oriented horizontally for ease of reading.</li>
<li>Media are ordered by increasing counts (total count rather than median) from bottom to top.</li>
<li>Within a panel, genres are similarly ordered.</li>
</ul>
</section>
<section id="final-thoughts" class="level2">
<h2 class="anchored" data-anchor-id="final-thoughts">Final thoughts</h2>
<p>Regarding their data table, the authors write,</p>
<blockquote class="blockquote">
<p>… some media were selected by large numbers of students, such as drawings by hand or computer, and writing such as poems and essays.</p>
</blockquote>
<p>The graph supports this assertion but emphasizes visually a couple of other points as well. Drawings by hand, essays, and non-haiku poetry were by far the most popular genres (adding up to nearly 50% of the submission encodings) and graphics was by far the most popular medium (about 60% of the encodings).</p>
<p>Mainly this chart gave me a chance to clarify something that my students would sometimes overlook—that a data structure with two categories and one quantitative variable are multiway data if and only if the categories are independent and a value of the response exists for each combination of levels of the two categories. Otherwise, we cannot expect to use a small-multiple design.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>