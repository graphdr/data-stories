{
  "hash": "3f7c45b3553ddf1ceb4d890c2a733e05",
  "result": {
    "markdown": "---\ntitle: \"Graphing the results of separate studies over time\"\ndescription: |\n  Combining the results of studies with different time spans in a single chart when changes over time are the story.\ndate: \"2022-06-01\"\ndate-format: \"YYYY-MM-DD\"\ncategories: [R, Data storytelling, ggplot2]\nimage: \"thumbnail.png\"\ncap-location: margin\ndraft: true\n---\n\n\n\n\n\n\n\n:::{.callout-note}\n## Summary \n<small><em>TBD</em></small>\n:::\n\nWhile working on a previous post, I cited an article on US sex education for adolescents [@Lindberg+Kantor:2022]. That article included a conventional clustered bar chart displaying results from the National Survey of Family Growth (NSFG). \n\nThe chart caught my attention because the story in the data is how research results evolve over time---yet time is not shown using a conventional horizontal scale. In this post, I redesign the chart with time as an independent variable encoded graphically as distance along an axis. \n\nAs with most of my redesign exercises, my purpose is not finding fault with the authors, but answering the questions:\n\n- Can I better align the logic of the chart with the logic of the argument?\n- In doing so, can I discover hidden aspects of the stories in the data?\n- And how do I make ggplot do what I want? \n\nThe R code for the post is listed under the “R code” pointers. \n\n\n::: {.cell}\n\n```{.r .cell-code}\n# packages used \nlibrary(\"data.table\")\nlibrary(\"ggplot2\")\nlibrary(\"ggpubfigs\")\n```\n:::\n\n\n\n\n\n## The original chart\n\nThe grouped bar chart by Lindberg and Kantor illustrates the changing fraction of US adolescents receiving sex education instruction from 1995 to 2019. The results are compiled from 5 studies, each with its own time span. Bars are clustered are by educational topic and student sex. \n\n![Original figure. Percentage of females and males aged 15–19 years who received instruction on specific sex education topics before the age of 18 years, by survey year, the National Survey of Family Growth.](gr2_lrg.jpg)\n\nIn their prose, the authors make the argument that \n\n> Young people today are less likely to receive instruction on key sex education topics than they were 25 years ago, as indicated by comparing the prevalence estimates from 2011--2015 and 2015--2019 calculated in this study to published estimates from earlier NSFG rounds. \n\nThe chart supports the assertion. The quantitative variable (percentage) is the bar height with bars shown in full to correctly avoid distorting the comparison. The gray-scale fills are appropriately sequential and the bars are arranged from left to right with survey year the implicit independent variable. \n\nA clustered-bar chart like this yields a qualitative visual result for a particular data cluster, for example, the evolution of Say No to Sex instruction for Females. The design does not, however, facilitate direct comparisons between different clusters.  Nor does it provide a visual encoding of the time spans involved. \n\n\n\n\n## Data structure\n\nThe data structure is outlined in @tbl-data-structure. The percentage of teens aged 15--19 receiving instruction is the single quantitative variable. Because three of the studies cover a span of years, both start and end years are recorded. \n\n<small>\n\n::: {#tbl-data-structure .cell tbl-cap='Data structure'}\n::: {.cell-output-display}\n|variable                      |structure                         |\n|:-----------------------------|:---------------------------------|\n|year study starts             |categorical, ordinal, five levels |\n|year study ends               |categorical, ordinal, five levels |\n|educational topic             |categorical, nominal, two levels  |\n|student sex                   |categorical, nominal, two levels  |\n|percent receiving instruction |quantitative                      |\n:::\n:::\n\n</small>\n\nI don't have the original data tables, so I approximated the values by measuring the bar lengths in the original figure. These estimates are available in the blog data directory as a [CSV file](https://raw.githubusercontent.com/graphdr/data-stories/main/data/sex-ed-topics-data.csv). \n\n\n::: {.cell}\n\n```{.r .cell-code}\n# read the data \ndt <- fread(\"data/sex-ed-topics-data.csv\", \n            colClasses = list(double = c(\"start\", \"end\", \"pct\")))\n\n# display\ndt[]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n    study start   end         Topic    Sex   pct\n    <int> <num> <num>        <char> <char> <num>\n 1:     1  1995  1995 Birth control Female    87\n 2:     1  1995  1995 Birth control   Male    81\n 3:     1  1995  1995 Say no to sex Female    92\n 4:     1  1995  1995 Say no to sex   Male    74\n 5:     2  2002  2002 Birth control Female    70\n 6:     2  2002  2002 Birth control   Male    66\n 7:     2  2002  2002 Say no to sex Female    86\n 8:     2  2002  2002 Say no to sex   Male    83\n 9:     3  2006  2010 Birth control Female    70\n10:     3  2006  2010 Birth control   Male    61\n11:     3  2006  2010 Say no to sex Female    89\n12:     3  2006  2010 Say no to sex   Male    82\n13:     4  2011  2015 Birth control Female    66\n14:     4  2011  2015 Birth control   Male    58\n15:     4  2011  2015 Say no to sex Female    84\n16:     4  2011  2015 Say no to sex   Male    82\n17:     5  2015  2019 Birth control Female    64\n18:     5  2015  2019 Birth control   Male    63\n19:     5  2015  2019 Say no to sex Female    81\n20:     5  2015  2019 Say no to sex   Male    80\n    study start   end         Topic    Sex   pct\n```\n:::\n:::\n\n\n\n\n\n\n\n## Redesign\n\nBecause the basic verbal argument describes a decline over 25 years, I select years as the independent variable and display it on a common horizontal scale. Like the original chart, percentage receiving instruction is the quantitative vertical scale.  \n\nOne interesting challenge is choosing the data markers (ggplot2 \"geoms\") when some studies appear in one year only and other studies span several years. My solution is to subset the data within the geom specification, using a point for the one-year studies and line segment for the studies that span more than one year.   \n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(\"graphclassmate\")\nggplot(dt) +\n  geom_point(data = dt[start == end], \n             mapping = aes(x = start, y = pct)) +\n  geom_segment(data = dt[start < end], \n               mapping = aes(x = start, xend = end, y = pct, yend = pct)) +\n  labs(x = \"Survey time span\", y = \"Percent\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\nThe symbols are aligned vertically, one column of points or segments for each study. There are four markers or segments per study indicating the results by sex and topic (corresponding to the four clusters in the original chart). \n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n### Additional software credits {.appendix}\n  \n- [`ggpubfigs`](https://github.com/JLSteenwyk/ggpubfigs) for color-vision-deficient-friendly palettes \n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": null
  }
}