{
  "hash": "c069136e0c08ee5c17b456001b865623",
  "result": {
    "markdown": "---\ntitle: \"Another case for redesigning dual axis charts\"\ndescription: |\n  An example of replacing a dual axis chart with alternatives better suited to drawing inferences about the data. \ndate: \"2022-06-06\"\ndate-format: \"YYYY-MM-DD\"\ncategories: [R, Data storytelling]\nimage: \"thumbnail.png\"\ncap-location: margin\ndraft: false\n---\n\n\n\n\n::: callout-note\n## Summary\n<em>The author of a recent article plots two time series in a dual axis chart as visual evidence of a correlation between the two series. I re-plot the data using three recommended alternatives: a side-by-side chart, an indexed chart, and a connected scatterplot. The alternate charts are superior to the dual axis chart for drawing inferences about the data.</em>\n:::\n\nDual axis charts, often used to compare two data series, are problematic even when designed with care. As Lisa Charlotte Muth explains, \n\n> We believe that charts with two different y-axes make it hard for most people to intuitively make right statements about two data series. We recommend two alternatives strongly: using two charts instead of one and using indexed charts. [@Muth:2018]\n\nMuth cites essays on the subject by Stephen Few [-@Few:2008], [Stephanie Evergreen](http://stephanieevergreen.com/two-alternatives-to-using-a-second-y-axis/), and [Cole Nussbaumer Knaflic](https://www.storytellingwithdata.com/blog/2016/2/1/be-gone-dual-y-axis), plus a StackOverflow thread by [Hadley Wickham](https://stackoverflow.com/questions/30987654321`99219/ggplot-with-2-y-axes-on-each-side-and-different-scales/3101876#3101876) on why ggplot2 does not support dual axis charts. \n\nIn this post, I critique a dual-axis chart of two time series, re-plot the data using a side-by-side chart, an indexed chart, and a connected scatterplot, and compare the messages conveyed by the new charts to those of the dual axis chart. \n\nFor reproducibility, the R code for the post is listed under the “R code” pointers.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# packages used \nlibrary(\"data.table\")\nlibrary(\"ggplot2\")\nlibrary(\"ggpubfigs\") # color vision deficient inclusive palettes \n```\n:::\n\n\n## The original chart\n\nIn a recent article, Christopher Newfield [-@Newfield:2021] addresses the structural racism of higher education funding. He uses data from the University of California (UC) system to illustrate several points. \n\nIn one instance, he uses the dual axis chart shown below to compare two time series of UC data from 1999 to 2017: declining percentage of White undergraduate enrollment and declining funding as a fraction of state personal income. \n\n![Original chart. [@Newfield:2021]](Newfield-fig2.jpg)\n\nReferring to the chart, Newfield writes, \n\n> ... as figure 2 illustrates, when the Democrats started their still-unbroken one-party rule of the legislature in the late 1990s, they did not break the racialized funding pattern in the state universities that [Gov. Pete] Wilson had launched. As white enrollment goes down, the state reduces net funding. The strong Democratic majority has defunded the UC system in *direct proportion* [emphasis mine] with its decline in white student share—except when the Arnold Schwarzenegger cuts and Jerry Brown cuts, also bipartisan, made it even worse.\n\nTo a data science practitioner, \"direct proportion\" implies a linear correlation between data series. In a dual axis chart, however, the appearance of correlation can be misleading because the scales of the two axes are arbitrary. \n\nThe article continues, \n\n> Whatever their intentions, Republicans and Democrats collectively gave less state support to the diverse UC than to the white UC on which both postwar parties had happily spent. \n\nAgreed. The chart yields this message as a direct observation. In a later chart I quantify these cuts, showing that levels of funding in 2017 are only 60% of their levels in 1999. \n\nHe concludes this section with, \n\n> They [the Democratic majority legislature] yoked ... major gains in BA attainment for students of color to steady funding cuts that saved money for the state's white voting majority.\n>\n> As the Biden-Harris administration settles in, it's worth remembering that the biggest blue state's higher education policy has been a textbook case of the systemic racism that became a national byword in 2020.\n\nGiven the data at hand, I show that charts better suited to the visual task can reveal nuances in the story obscured by the dual axis design. \n\n\n\n## Data structure\n\nThe data structure is outlined in @tbl-data-structure: two quantitative variables evolving over time (yearly). The funding measurement is a ratio of (presumably) nominal dollars in each year, so adjusting for inflation is unnecessary. \n\n\n\n::: {#tbl-data-structure .cell tbl-cap='Data structure'}\n::: {.cell-output-display}\n|variable                          |structure            |\n|:---------------------------------|:--------------------|\n|year                              |categorical, ordinal |\n|percent White enrollment          |quantitative         |\n|UC funds fraction of state income |quantitative         |\n:::\n:::\n\n\n\nI transcribed the data values from the original chart. These data are available in the blog data directory as a [CSV file](https://raw.githubusercontent.com/graphdr/data-stories/main/data/budget-justice.csv). Here I add the governors' names for annotating the charts. \n\n\n::: {.cell}\n\n```{.r .cell-code}\n# read from the blog data directory\ndt <- fread(\"data/budget-justice.csv\", \n            colClasses = list(double = c(\"year\", \"white_pct\")))\n\n# add governor names\ndt[, gov := fcase(\n  year < 2004, \"Gray Davis\", \n  year >= 2004 & year < 2011, \"A. Schwarzenegger\", \n  year >= 2011, \"Jerry Brown\")]\n\n# display\ndt[]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n     year white_pct fund_frac               gov\n    <num>     <num>     <num>            <char>\n 1:  1999        40      0.43        Gray Davis\n 2:  2000        40      0.44        Gray Davis\n 3:  2001        39      0.41        Gray Davis\n 4:  2002        38      0.42        Gray Davis\n 5:  2003        38      0.40        Gray Davis\n 6:  2004        37      0.35 A. Schwarzenegger\n 7:  2005        37      0.34 A. Schwarzenegger\n 8:  2006        36      0.33 A. Schwarzenegger\n 9:  2007        36      0.33 A. Schwarzenegger\n10:  2008        35      0.20 A. Schwarzenegger\n11:  2009        34      0.22 A. Schwarzenegger\n12:  2010        33      0.32 A. Schwarzenegger\n13:  2011        32      0.24       Jerry Brown\n14:  2012        30      0.24       Jerry Brown\n15:  2013        29      0.26       Jerry Brown\n16:  2014        28      0.27       Jerry Brown\n17:  2015        27      0.27       Jerry Brown\n18:  2016        26      0.28       Jerry Brown\n19:  2017        25      0.27       Jerry Brown\n```\n:::\n:::\n\n\n\n\n\n\n## Side-by-side chart\n\nMuth and others recommend plotting two data series in separate charts. Stephen Few, for example, says\n\n> The first and most obvious [approach] is to place them in separate graphs, positioned close to one another so that the patterns in each can be compared to one another, but magnitude comparisons will be discouraged. [@Few:2008]\n\nFollowing this prescription, I plot the two data series in @fig-two-charts using separate panels having their own vertical, quantitative scales but sharing a common time scale. I select an aspect ratio that emphasizes the slopes of the line segments. \n\nNewfield mentions the terms of two California governors, so I annotate the chart to indicate the gubernatorial terms that span these data: Gray Davis (Democrat), Arnold Schwarzenegger (Republican), and  Jerry Brown (Democrat). \n\n\n::: {.cell fig.asp='0.4'}\n\n```{.r .cell-code}\n# transform to block record form\ndt_melt <- melt(dt, \n                measure.vars  = c(\"white_pct\", \"fund_frac\"), \n                variable.name = \"data_series\", \n                value.name    = \"value\")\n\n# stand-alone data frame for annotating gubernatorial terms\ngov_text <- data.frame(\n  label = c(\"Davis\", \"Schwarzenegger\", \"Brown\"),\n  data_series = \"fund_frac\",\n  x = c(2001, 2007.5, 2014),\n  y = 0.38\n)\n\n# vector for relabeling the facets\nfacet_labels <- c(\"UC funding fraction of state personal income\", \n                  \"White undergraduate % enrollment\")\nnames(facet_labels) <- c(\"fund_frac\", \"white_pct\")\n\n# chart\nggplot(data = dt_melt, mapping = aes(x = year, y = value)) +\n  facet_wrap(vars(data_series), \n             ncol = 2, \n             scales = \"free_y\", \n             labeller = labeller(data_series = facet_labels)) +\n  geom_line(size = 0.5, linetype = 2) +\n  geom_point(size = 2) +\n  scale_x_continuous(minor_breaks = seq(1999, 2017, 1)) +\n  labs(x = \"Year\", y = \"\") +\n  theme(panel.grid.minor.y = element_blank()) +\n  \n  # delineate gubernatorial terms\n  geom_vline(xintercept = c(2004, 2011), \n             color = \"gray30\", \n             size = 0.5, \n             linetype = 2) +\n  geom_text(data = gov_text,\n            mapping = aes(x = x, y = y, label = label),\n            size = 3)\n```\n\n::: {.cell-output-display}\n![Redrawing the dual axis chart as a side-by-side chart with gubernatorial terms delineated.](index_files/figure-html/fig-two-charts-1.png){#fig-two-charts width=672}\n:::\n:::\n\n\nThe decrease in the White undergraduate population fraction is fairly steady over this time span. This is not surprising given the changing demographics of the state: in 2000, Non-Hispanic whites were 46% of the state population; in 2010, 40%; and in 2020, 35% [@Allen+Turner:2011; @McGhee+Paluch+Hsieh:2021]. \n\nUC funding decreases as well, but with greater irregularity, especially during the Schwarzenegger years. Even ignoring the cuts associated with the 2008 global financial debacle, Schwarzenegger's tenure concludes with the largest cuts in the data set.  \n\nYet contrary to Newfield's assertion that Jerry Brown’s cuts “made it even worse,\" the funding trend changes course under Brown. It doesn't get much better, but it doesn't get worse either.\n\n\n## Indexed chart\n\nThe second choice of many experts is the indexed chart. Again, from Stephen Few, \n\n> The other less obvious solution, which works only for time series, is to convert all sets of values to a common quantitative scale by displaying percentage differences between each value and a reference (or index) value.  For instance, select a particular point in time, such as the first interval that appears in the graph, and express each subsequent value as the percentage difference between it and the initial value. [@Few:2008]\n\nSelecting 1999 as the index year, in @fig-indexed I graph enrollment change with respect to its index (40%) and funding change with respect to its index (0.43). Thus both series share a common quantitative scale as well as a common time scale. \n\nIn reading the chart, for example, a change of −10%    indicates the variable has dropped by 10% relative to its 1999 index value. \n\n\n::: {.cell fig.asp='0.8'}\n\n```{.r .cell-code}\n# transform to block record form \ndt_idx <- melt(dt, \n               measure.vars = c(\"white_pct\", \"fund_frac\"), \n               variable.name = \"data_series\", \n               value.name = \"measure\")\n\n# compute percent change relative to 1999\nsetkeyv(dt_idx, c(\"data_series\", \"year\"))\ndt_idx[, idx := measure[1], by = c(\"data_series\")]\ndt_idx[, rel_change :=  100 * ((measure / idx) - 1)]\n\n# create the base chart for all versions of indexed charts\np <- ggplot(data = dt_idx, \n            mapping = aes(x = year, y = rel_change, color = data_series)) +\n  \n  # 1999 baseline\n  geom_segment(aes(x = 1999, xend = 2017, \n                   y = 0, yend = 0), \n                   color = \"gray30\", \n                   size = 0.5) +\n  annotate(\"text\", \n           x = 2017, \n           y = 0, \n           label = \"1999 baseline\", \n           hjust = 1, \n           vjust = -0.5) +\n  \n  # delineate gubernatorial terms\n  geom_vline(xintercept = c(2004, 2011),\n             color = \"gray30\",\n             size = 0.5,\n             linetype = 2) +\n  geom_text(data = dt_idx[data_series == \"fund_frac\" & year %in% c(2001, 2008, 2014)], \n            mapping = aes(y = -56, label = gov), \n            color = \"black\") +\n  \n  # label the two data series\n  annotate(\"text\", \n           x = 2017, \n           y = c(-22, -44), \n           label = c(\"White enrollment share\", \"Funding\"), \n           hjust = c(1, 1), \n           vjust = c(0, 0)) +\n  \n  # points, scales, labels, theme\n  geom_point(size = 3) + \n  labs(x = \"Year\", y = \"Percent change since 1999\") +\n  scale_color_manual(values = friendly_pal(\"contrast_three\")) + \n  scale_x_continuous(breaks = seq(2000, 2020, 5), \n                     minor_breaks = seq(1999, 2020, 1)) + \n  scale_y_continuous(breaks = seq(-50, 0, 10), \n                     labels = c(paste0(\"\\U2212\", seq(50, 10, -10)), paste0(\"\\U00B1\", \"0%\"))) +\n  theme(panel.grid.minor.y = element_blank(), \n        legend.position = \"none\")\n\n# connect the dots for the first indexed chart\np + geom_line(linetype = 1, size = 0.5)\n```\n\n::: {.cell-output-display}\n![How UC enrollment and funding change relative to their values in 1999.](index_files/figure-html/fig-indexed-1.png){#fig-indexed width=672}\n:::\n:::\n\n\nIn an indexed chart, lines that are *locally parallel* indicate a potential correlation between data series. \n\nTo check for parallels, I replace the connect-the-dots lines with regression curves. At first glance, the lines are approximately parallel, suggesting a correlation. The problem is lack of fit: a linear fit is a good model for the enrollment data but a poor model for the funding data.    \n\n\n::: {.cell fig.asp='0.8'}\n\n```{.r .cell-code}\n# plot overall regression lines\np + geom_smooth(method = \"lm\", se = FALSE, size = 0.5)\n```\n\n::: {.cell-output-display}\n![Trying a linear fit to both data series.](index_files/figure-html/fig-indexed-2-1.png){#fig-indexed-2 width=672}\n:::\n:::\n\n\nThe shape of the funding data is clearly different from one governor to the next. In the next chart, I create separate funding regressions by governor, ignoring the 2008-09 data as outliers, and I leave the enrollment linear fit as is. The aspect ratio is arbitrary: in this chart, relative parallelism is the indicator, not the slope itself.  \n\n \n\n::: {.cell fig.asp='0.8'}\n\n```{.r .cell-code}\n# leave enrollment fit as is\np + geom_smooth(data = dt_idx[data_series == \"white_pct\"], \n                method = \"lm\", \n                se = FALSE, \n                size = 0.5) +\n  \n  # add regression lines by governor\n  geom_smooth(data = dt_idx[data_series == \"fund_frac\" & year <= 2004],\n              method = \"lm\", \n              se = FALSE, \n              size = 0.5) +\n  geom_smooth(data = dt_idx[data_series == \"fund_frac\" & year %in% c(2004:2007, 2010:2011)],\n              method = \"lm\",\n              se = FALSE,\n              size = 0.5) +\n  geom_smooth(data = dt_idx[data_series == \"fund_frac\" & year >= 2011],\n              method = \"lm\", \n              se = FALSE, \n              size = 0.5)\n```\n\n::: {.cell-output-display}\n![Applying separate funding regressions by governor.](index_files/figure-html/fig-indexed-3-1.png){#fig-indexed-3 width=672}\n:::\n:::\n\n\nAgain looking for parallel lines, I think this chart brings the shapes of the funding trends by governor more clearly to the forefront. \n\n- Under Davis, the enrollment and funding lines are nearly parallel, indicating a potential correlation. \n- Under Schwarzenegger, the lines are again roughly parallel though at lower funding levels---again indicating a potential correlation. \n- Under Brown, the two lines are clearly not parallel---a negative slope for enrollment, a positive slope for funding.  These results argue against a correlation under Brown.  \n\n\n\n\n\n\n## Connected scatterplot\n\nScatterplots are designed to reveal correlations between two quantitative variables.  \n\nHowever, our two quantitative variables are both time series, adding a third variable to the story. To account for the time sequence, the data markers in a scatterplot are sequentially connected---yielding the \"connected scatterplot\" design. As Muth says, \n\n> Suddenly, time doesn’t move from left to right, but wiggles through space.\n\nThe connected scatterplot for the UC enrollment/funding data is given in @fig-first-design: enrollment data along the x-axis, funding data along the y-axis; each data marker represents the enrollment-funding relationship in a given year; data markers are connected in sequence by year; and starting and ending years are labeled to orient the reader. The 1:1 aspect ratio makes relative diagonals easier to identify (more on this shortly).\n\n\n::: {.cell fig.asp='1'}\n\n```{.r .cell-code}\nggplot(dt, aes(x = white_pct, y = fund_frac)) +\n  geom_path(linetype = 2) +\n  geom_point(size = 3) +\n  labs(x = \"White undergraduate enrollment (%)\", \n       y = \"UC funding / State  personal income\") +\n  geom_text(data = dt[year %in% c(1999, 2017)],\n           aes(label = year), \n           nudge_y = - 0.01)\n```\n\n::: {.cell-output-display}\n![Initial connected scatterplot.](index_files/figure-html/fig-first-design-1.png){#fig-first-design width=672}\n:::\n:::\n\n\nThe non-intuitive aspect of this chart is that time reads from right to left, which is likely to confuse some readers. \n\nI reverse the direction of the time path in @fig-third-design by transforming the enrollment variable to percent enrollment of students of color (which increases over time.) I also encode the gubernatorial terms using color and add several year labels to assist the reader. (The data marker for 2006 overprints the identical value for 2005.) The color palette is selected to accommodate viewers with a color vision deficiency.  \n\n\n::: {.cell fig.asp='1'}\n\n```{.r .cell-code}\n# add end-of-term dummy rows grouping by governor\ndum_row <- copy(dt)\ndum_row <- dum_row[year == 2004 | year == 2011]\ndum_row[year == 2004, gov := \"Gray Davis\"]\ndum_row[year == 2011, gov := \"A. Schwarzenegger\"]\ndt_conn <- rbindlist(list(dt, dum_row))\n\n# add a column to ensure correct order\ndt_conn[, order_gov := fcase(\n  gov %chin% \"Gray Davis\", 1, \n  gov %chin% \"A. Schwarzenegger\", 2,\n  gov %chin% \"Jerry Brown\", 3 \n)]\nsetkeyv(dt_conn, c(\"year\", \"order_gov\"))\n\n# base plot for connected scatterplot. color = gov uses the dummy rows\np <- ggplot(dt_conn, aes(x = 100 - white_pct, y = fund_frac, color = gov)) +\n  geom_point(size = 3) +\n  labs(x = \"Enrollment of students of color (%)\", \n       y = \"UC funding / State  personal income\") +\n  theme(legend.position = \"none\") +\n  \n  # label selected years with original dt\n  geom_text(data = dt[year %in% c(1999, 2004, 2008, 2011, 2017)],\n           aes(label = year), \n           color = \"black\", \n           nudge_x = 0.7  * c( 0,  -1, -1,  0,  0), \n           nudge_y = 0.01 * c(-1,   0, 0.5, -1, -1)) +\n  \n  # label governors once per span\n  geom_text(data = dt_conn[year %in% c(2001, 2008, 2014)], \n            mapping = aes(label = gov), \n            nudge_x = 0.5 * c(0, -1, 0), \n            nudge_y = 0.03 * c(-1, 2, -1), \n            fontface = \"bold\")\n\n# first connected scatterplot chart, connect the dots\nq <- p + geom_path(linetype = 2)\nq\n```\n\n::: {.cell-output-display}\n![Final connected scatterplot. UC funding as a function of percent enrollment of students of color.](index_files/figure-html/fig-third-design-1.png){#fig-third-design width=672}\n:::\n:::\n\n\n\nIn a connected scatterplot, lines on a *relative diagonal* indicate a potential correlation between variables.\n\n> ... positive correlations show up as relatively diagonal lines along the \"forward slash\" axis of the connected scatterplot, while negative correlations show up on the \"backslash\" axis. [@Haroz+Kosara+Franconeri:2016]\n\nTo help tease out the underlying visual pattern, I add regression lines within the gubernatorial segments as before (ignoring the funding data in 2008--09 as outliers), yielding @fig-sc-regression. The 1:1 aspect ratio makes relative diagonals easier to identify.  \n\n\n::: {.cell fig.asp='1'}\n\n```{.r .cell-code}\n# plot regression lines over gubernatorial terms\nq + geom_smooth(data = dt_conn[!year %in% c(2008, 2009)], \n                method = \"lm\", \n                se = FALSE, \n                size = 1)\n```\n\n::: {.cell-output-display}\n![Identifying potential correlations over different gubernatorial terms.](index_files/figure-html/fig-sc-regression-1.png){#fig-sc-regression width=672}\n:::\n:::\n\n\nThe chart yields a story consistent with my earlier findings,    \n\n- A negative diagonal, as in the Davis and Schwarzenegger years, indicates a negative correlation, that is, a correlation between decreasing funding and increasing percent enrollment of students of color. \n- A relatively flat slope, as in the Brown years, indicates that funding is fairly static, independent of the change in population fraction. No correlation. \n\n\n\n\n\n\n\n\n## Discussion \n\nEach of the three alternate chart designs is more effective than the dual axis chart at revealing and conveying the stories in these data. \n\nOf the three alternatives, I suspect that the side-by-side chart would work best for most audiences. The trends can be seen without having to explain the normalization of the indexed chart or the path-through-time of the connected scatterplot. \n\nHowever, the indexed chart and the connected scatterplot are better than the side-by-side chart at revealing correlations: parallel lines in the indexed chart; diagonal lines in the connected scatterplot. \n\nTaken all together, I think the revised charts support these statements:  \n\n- UC funding was cut under Democratic governor Gray Davis and cut even more under Republican governor Schwarzenegger. \n- UC funding leveled off under Democratic governor Brown---not improving much but not getting worse. \n- Over the same time period, the fraction of White undergraduate enrollment steadily decreased. \n\nAnd these inferences: \n\n- The increasing percentage of students of color is consistent with the increasing percentage of people of color in the state. \n- The correlation between race and funding is more readily demonstrated for Davis' and Schwarzenegger's terms in office than it is in Brown's. \n\nYet, as Newfield reminds us---before, during, and after the time span of these data, the *legislature* has been under one-party, Democratic rule; a legislature that has repeatedly cut the UC budget such that in 2017 funding as a percent of state personal income is only 60% of what it was in 1999---a persistent devaluation of higher education as a public good. \n\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}