{
  "hash": "12c8e2a9e9087d1040fa349aba71db68",
  "result": {
    "markdown": "---\ntitle: Facets that are not small multiples\ndescription: |\n  Using the scales and space arguments of facet_grid() to manage \n  panel heights of faceted charts when categories are not independent. \ndate: 2022-03-09\ndate-format: \"YYYY-MM-DD\"\ndraft: false\ncategories: [ggplot2, R]\nimage: thumbnail.png\n---\n\n\n\n\n\n> Summary. For data structures having two categorical variables and one quantitative variable, this post illustrates how category independence or dependence influences chart design. Graphs with independent categories (multiway data) are easily created in ggplot2 with the `facet_wrap()` function; data with dependent categories require `facet_grid()` with its `scales` and `space` arguments to treat unequal vertical scales.\n\n*Small multiple* design is a good design choice for many data structures. To facilitate visual comparisons, every small-multiple frame (variously called panels, facets, or subplots) has identical scales.\n\n> Small multiples resemble the frames of a movie: a series of graphics, showing the same combination of variables, indexed by changes in another variable. [@Tufte:1983, 170]\n\n*Multiway data*---a data structure comprising two independent categorical variables and one quantitative response variable---is well-matched to small multiple design. \n\n> What distinguishes multiway data is the cross-classification of the categorical variables; there is a value of the response for each combination of levels of the two categorical variables [@Cleveland:1993, 303]. \n\nHowever, if the categories happen to be *dependent*, the data are not multiway and the small multiple design fails. Having come across data of this type in a recent article, I thought it would be interesting to illustrate, given one quantitative variable and two categorical variables, how category independence or dependence influences chart design. \n\nI start with a multiway data set and point out that, as a small-multiple design,  the panels share common scales. In ggplot2, small multiples are usually created using `facet_wrap()`. \n\nThe second example has data with dependent categories. The panels share a common, horizontal, quantitative scale but have different category scales, yielding facets that are not small multiples. I use `facet_grid()` with its `scales` and `space` arguments to treat the unequal vertical scales.  \n\nThe R code for the post is listed under the “R code” pointers.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# packages used \nlibrary(\"data.table\")\nlibrary(\"ggplot2\")\n```\n:::\n\n\n\n\n\n## Multiway example\n\nThe literal textbook example of multiway data and chart design is the livestock chart by Cleveland [-@Cleveland:1993, 303]. The data set contains  counts of 5 types of farm animals in 26 countries in 1967. The independent categories are country and animal type; the quantitative variable is the count. \n\nI obtained a reproduction of the data from [@UCLA:2021] and saved it as a CSV file in the blog data directory. \n\n\n::: {.cell}\n\n```{.r .cell-code}\n# read the livestock data\nDT <- fread(\"livestock-1967.csv\")\n\n# examine the data\nDT[]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n     livestock_type        country    count\n             <char>         <char>    <num>\n  1:         Cattle        Albania   478000\n  2:         Cattle        Austria  2536000\n  3:         Cattle        Belgium  3246000\n  4:         Cattle       Bulgaria  1796000\n  5:         Cattle Czechoslovakia  5131000\n ---                                       \n126:          Sheep    Switzerland   336000\n127:          Sheep         Turkey 70093000\n128:          Sheep United Kingdom 32888000\n129:          Sheep  Russia et al. 21000000\n130:          Sheep     Yugoslavia  7384000\n```\n:::\n:::\n\n\nThe countries are assigned to the rows such that the median count by country increases from bottom to top. The livestock are assigned to the panels such that median count by livestock type increases in *graphical order:* increasing  from left to right and from bottom to top. The logarithm of counts is used for the quantitative scale counts vary by more than four powers of 10. \n\n\n::: {.cell fig.asp='1.2'}\n\n```{.r .cell-code}\nggplot(data = DT, mapping = aes(x = log10(count), y = reorder(country, count, median))) +\n  geom_point() + \n  facet_wrap(vars(reorder(livestock_type, count, median)), as.table = FALSE) +\n  labs(x = expression('Log'[10]~'number of livestock'), y = \"\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/chart-livestock-1.png){width=672}\n:::\n:::\n\n\nTypical of small multiple charts in general, all five panels have identical  horizontal scales (the count) and identical vertical axes (countries). It follows that the size and aspect ratio of each panel are also identical. \n\n\n\n## When categories are dependent\n\nThe data set that inspired this post is from an article on a creative expression assignment used in a first-year engineering course [@Chambers+Reid:2021]. In response to COVID-19, the course had transitioned from a highly interactive, in-person experience to an asynchronous, online model. \n\n> The instructors designed an assignment to encourage students to creatively express how the course interruption and transition online was affecting them. The assignment encouraged complete freedom of expression and choice of media. \n\nA data table in the article reports how the student work is coded: 28 creative genres (prose, lyrics, music performance, dance, YouTube, etc.) grouped into 6  media categories (writing, performance, video, graphics, etc.). The quantitative variable is the count of encodings by genre. \n\nSome submissions covered multiple media and genres, for example, an original song in a video would be coded as both. Thus the total of the `count` column (304 encodings) exceeds the number of submissions (N = 265). The `percent` column is a derived variable that reports the count as a percentage of N. The sum of the `percent` column is therefore greater than 100%. \n\nThe data are available in the blog data directory. \n\n\n::: {.cell}\n\n```{.r .cell-code}\n# import the data\nDT <- fread(\"creative-assignment-2021.csv\")\n\n# print the data table\nDT[]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n         medium                 genre count percent\n         <char>                <char> <int>   <num>\n 1:     Writing                 Prose     6     2.3\n 2:     Writing                 Essay    32    12.1\n 3:     Writing              Word art     6     2.3\n 4:     Writing    Poetry (not haiku)    32    12.1\n 5:     Writing                 Haiku     4     1.5\n 6:       Music                Lyrics     3     1.1\n 7:       Music              Playlist     3     1.1\n 8: Performance Music from instrument     6     2.3\n 9: Performance  Performance of music     6     2.3\n10: Performance                 Dance     2     0.8\n11: Performance           Spoken word     2     0.8\n12:   Sculpture      Arranged objects     6     2.3\n13:   Sculpture             Sculpture     2     0.8\n14:   Sculpture                  Lego     2     0.8\n15:       Video                TikTok     7     2.6\n16:       Video               YouTube     4     1.5\n17:       Video            Short-form     9     3.4\n18:       Video                 Music     3     1.1\n19:       Video           Spoken word     5     1.9\n20:    Graphics               Collage    13     4.9\n21:    Graphics              Painting    18     6.8\n22:    Graphics       Drawing by hand    58    21.9\n23:    Graphics   Drawing by computer    10     3.8\n24:    Graphics           Photography    15     5.7\n25:    Graphics               Cartoon    18     6.8\n26:    Graphics                 Emoji     6     2.3\n27:    Graphics                  Meme    22     8.3\n28:    Graphics            Web design     4     1.5\n         medium                 genre count percent\n```\n:::\n:::\n\n\nThe graph I have in mind would have media type assigned to rows and media category assigned to panels. Unlike the livestock example, however, the categorical variables in these data are not independent. For example, web design is associated only with graphics, essay is associated only with writing,  etc. \n\nIn my first attempt, I use `facet_wrap()` like I did with the livestock data. The visual problem is obvious...every row has a data marker in one panel only. Because the categories are not independent, the small-multiple design fails. \n\n\n::: {.cell fig.asp='1.6'}\n\n```{.r .cell-code}\n# create the first chart \np <- ggplot(data = DT, mapping = aes(x = percent, y = reorder(genre, count))) +\n  geom_point() + \n  facet_wrap(vars(reorder(medium, count)) , as.table = FALSE) +\n  labs(y = \"\")\n\n# display the result\np\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/chart-assignment-1-1.png){width=672}\n:::\n:::\n\n\nThe `scales = \"free_y\"` argument of `facet_wrap()` replaces the common y-scale with only those row labels associated with a panel. I also use the `ncol` argument to stack the panels in one column with all rows labels aligned on the left. This graph has the essential layout I had in mind---a common quantitative scale but different vertical scales, yielding facets that are not small multiples.  \n\n\n::: {.cell fig.asp='1.5'}\n\n```{.r .cell-code}\n# edit the previous chart \np <- p +\n   facet_wrap(vars(reorder(medium, count)) , as.table = FALSE, scales = \"free_y\", ncol = 1)\n\n# display the result\np\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/label- chart-assignment-2-1.png){width=672}\n:::\n:::\n\n\nBecause `facet_wrap()` creates panels of equal height, the rows in this case are unequally spaced. \n\nI switch to `facet_grid()` to space the rows equally in panels of unequal height. The  `space = \"free_y\"` argument is added to make the  panel height proportional to the length of the y scale. \n\n\n::: {.cell fig.asp='1'}\n\n```{.r .cell-code}\n# edit the previous chart \np <- p  +\n  facet_grid(rows = vars(reorder(medium, count)), \n             as.table = FALSE, \n             scales = \"free_y\",\n             space = \"free_y\")\n\n# display the result\np\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/chart-assignment-3-1.png){width=672}\n:::\n:::\n\n\n\n## Editing the chart\n\nWhile the  overall layout above is what I want, I would prefer to move the panel labels from the right-hand side to the top of each panel. I could not find a way to do that, so I removed the right-hand label and wrote the media label inside the panel. I edited some other aesthetics as well. \n\n\n::: {.cell fig.asp='1'}\n\n```{.r .cell-code}\n# create a y-coordinate for a text geom\nDT <- DT[, y_coord_media := .N/2 + 0.5, by = medium]\n\n# create secondary axis data, omit some labels to avoid overprinting\ncount_scale <- sort(unique(DT$count))\ntop_axis <- data.table(count_scale)\ntop_axis[, count_label := as.character(count_scale)]\nomit_labels <- c(\"3\", \"5\", \"7\", \"9\", \"15\")\ntop_axis[count_label %chin% omit_labels, count_label := \"\"]\n\n# ratio for secondary axis transformation\nscale_trans <- sum(DT$count) / sum(DT$percent)\n\n# graph\nggplot(data = DT, mapping = aes(x = percent, y = reorder(genre, count))) +\n  geom_point(size = 2) +\n  facet_grid(rows = vars(reorder(medium, count)), \n             as.table = FALSE, \n             scales = \"free_y\",\n             space = \"free_y\") +\n  labs(x = \"Genre encodings (%)\", y = \"Genre\") +\n  theme_light() +\n  theme(strip.text.y = element_blank(), \n        panel.grid.minor = element_blank(),\n        axis.title.y = element_text(angle = 0, hjust = 1, vjust = 0.5)) +\n  geom_text(aes(x = 24, y = y_coord_media, label = medium, hjust = 1), color = \"gray50\") +\n  scale_x_continuous(sec.axis = sec_axis(trans = function(z) (z * scale_trans), \n                                         name = \"Count of genre encodings\", \n                                         breaks = top_axis$count_scale, \n                                         labels = top_axis$count_label))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/label- chart-assignment-4-1.png){width=672}\n:::\n:::\n\n\nFeatures of the graph\n\n- `facet_grid()` as shown earlier for panels of unequal height with rows equally spaced.\n- `geom_text()` for panel labels, vertically centered. \n- `sec_axis()` for a secondary scale along the top of the chart showing counts of genre encodings from the data table.\n- `theme_light()` for gray lines on white background to focus attention on the data. \n- All text is oriented horizontally for ease of reading. \n- Media are ordered by increasing counts (total count rather than median) from bottom to top. \n- Within a panel, genres are similarly ordered. \n\n\n\n\n\n## Final thoughts\n\nRegarding their data table, the authors write, \n\n> ... some media were selected by large numbers of students, such as drawings by hand or computer, and writing such as poems and essays.  \n\nThe graph supports this assertion but emphasizes visually a couple of other points as well. Drawings by hand, essays, and non-haiku poetry were by far the most popular genres (adding up to nearly 50% of the submission encodings) and graphics was by far the most popular medium (about 60% of the encodings).  \n\nMainly this chart gave me a chance to clarify something that my students would sometimes overlook---that a data structure with two categories and one quantitative variable are multiway data if and only if the categories are independent and a value of the response exists  for each combination of levels of the two categories. Otherwise, we cannot expect to use a small-multiple design. \n\n\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": null
  }
}